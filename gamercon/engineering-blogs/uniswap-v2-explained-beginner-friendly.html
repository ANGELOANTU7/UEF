<!DOCTYPE html><!-- This site was created in Webflow. https://www.webflow.com --><!-- Last Published: Mon Jul 17 2023 22:17:53 GMT+0000 (Coordinated Universal Time) --><html data-wf-domain="flow-com.webflow.io" data-wf-page="637380c394c328ab5ad74bb3" data-wf-site="5f734f4dbd95382f4fdfa0ea" lang="en">
<!-- Mirrored from flow.com/engineering-blogs/uniswap-v2-explained-beginner-friendly by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 22 Jul 2023 16:25:20 GMT -->
<head><meta charset="utf-8"/><title>Uniswap V2 Explained (Beginner Friendly)</title><meta content="Feb 28, 2022" name="description"/><meta content="Uniswap V2 Explained (Beginner Friendly)" property="og:title"/><meta content="Feb 28, 2022" property="og:description"/><meta content="" property="og:image"/><meta content="Uniswap V2 Explained (Beginner Friendly)" property="twitter:title"/><meta content="Feb 28, 2022" property="twitter:description"/><meta content="" property="twitter:image"/><meta property="og:type" content="website"/><meta content="summary_large_image" name="twitter:card"/><meta content="width=device-width, initial-scale=1" name="viewport"/><meta content="goOrjM0FiQtmK2lUJ9Y5NpPJA-fMUUc_6Q6Vmd7-XIY" name="google-site-verification"/><meta content="Webflow" name="generator"/><link href="../../assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/css/flow-com.webflow.9325b97a3.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/" rel="preconnect"/><link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin="anonymous"/><script src="../../ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script><script type="text/javascript">WebFont.load({  google: {    families: ["Epilogue:300,regular,500,600,700,800,900,italic"]  }});</script><script src="../../use.typekit.net/mgu2ukv.js" type="text/javascript"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script><script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script><link href="../../assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/616b1520779838b5f9174363_favicon.png" rel="shortcut icon" type="image/x-icon"/><link href="../../assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/616b1548fd01d005fc2bc2c7_logo256.png" rel="apple-touch-icon"/><link href="uniswap-v2-explained-beginner-friendly.html" rel="canonical"/><style>
  .w-webflow-badge {
    display: none !important;
  }
</style>


<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'../../www.googletagmanager.com/gtm5445.html?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PWSGFLB');</script>
<!-- End Google Tag Manager -->


<meta name="facebook-domain-verification" content="dhlb5fcuitl7owilmsg6xh307ohoyc" />

<!-- Hotjar Tracking Code for Flow.com -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:3329982,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
<link rel="stylesheet" href="../../cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" /></head><body><div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="navigation w-nav"><div class="nav-container w-container"><a href="../index.html" class="nav-logo-div w-nav-brand"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63ce603ae36f46f6bb67e51e_flow-logo.svg" loading="lazy" alt="flow logo" class="hide"/><div aria-label="Flow logo" class="nav-logo__embed w-embed"><svg width="100" height="42" viewBox="0 0 100 42" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_106_24812)">
<path class="logotype" d="M57.3672 20.9501H54.6797V30.971H50.9297V20.9501H48.9922V17.7376H50.9297V16.4876C50.9297 13.2501 52.9505 11.5876 56.0214 11.5876C56.4968 11.5916 56.9705 11.6475 57.4339 11.7543V15.5043C57.0296 15.3422 56.5985 15.2574 56.163 15.2543C55.9663 15.2387 55.7684 15.2659 55.5832 15.334C55.3979 15.4021 55.2296 15.5096 55.0899 15.6489C54.9501 15.7883 54.8422 15.9563 54.7735 16.1414C54.7049 16.3264 54.6771 16.5242 54.6922 16.721V17.7168H57.3797L57.3672 20.9501ZM63.013 30.971H59.2214V11.871H63.013V30.971Z" fill="black"/>
<path class="logotype" d="M71.4292 16.9085C72.851 16.906 74.2415 17.3255 75.4247 18.1139C76.6079 18.9023 77.5306 20.024 78.0758 21.3371C78.6211 22.6502 78.7644 24.0956 78.4876 25.4902C78.2108 26.8848 77.5264 28.1658 76.5211 29.1712C75.5157 30.1766 74.2346 30.861 72.84 31.1377C71.4454 31.4145 70.0001 31.2712 68.687 30.726C67.3739 30.1807 66.2521 29.2581 65.4638 28.0749C64.6754 26.8917 64.2559 25.5011 64.2584 24.0793C64.2466 23.1344 64.4241 22.1967 64.7803 21.3213C65.1365 20.446 65.6642 19.6508 66.3325 18.9826C67.0007 18.3144 67.7959 17.7866 68.6712 17.4304C69.5465 17.0742 70.4842 16.8968 71.4292 16.9085V16.9085ZM71.4292 27.596C73.3667 27.596 74.7625 25.9877 74.7625 24.0793C74.7834 23.6288 74.7126 23.1787 74.5544 22.7563C74.3963 22.3339 74.1541 21.9481 73.8424 21.622C73.5308 21.296 73.1562 21.0366 72.7414 20.8595C72.3266 20.6824 71.8802 20.5914 71.4292 20.5918C70.5213 20.6232 69.661 21.0058 69.0298 21.6592C68.3986 22.3125 68.0458 23.1855 68.0458 24.0939C68.0458 25.0024 68.3986 25.8753 69.0298 26.5286C69.661 27.182 70.5213 27.5647 71.4292 27.596Z" fill="black"/>
<path class="logotype" d="M82.5576 17.1875L84.9951 26.3542L87.4326 19.0708L86.7659 17.1917H90.5159L93.7284 26.3583L96.1076 17.1917H99.9992L95.9034 30.975H91.9701L89.2284 23.4167L86.6659 30.9708H82.7076L78.6367 17.1875H82.5576Z" fill="black"/>
<path d="M20.8333 41.8334C32.3393 41.8334 41.6667 32.506 41.6667 21.0001C41.6667 9.49415 32.3393 0.166748 20.8333 0.166748C9.3274 0.166748 0 9.49415 0 21.0001C0 32.506 9.3274 41.8334 20.8333 41.8334Z" fill="#00EF8B"/>
<path d="M29.9732 17.7417H24.0898V23.625H29.9732V17.7417Z" fill="white"/>
<path d="M18.2138 25.8292C18.2138 26.266 18.0843 26.6929 17.8416 27.0561C17.599 27.4192 17.2541 27.7023 16.8506 27.8694C16.447 28.0366 16.003 28.0803 15.5746 27.9951C15.1463 27.9099 14.7528 27.6996 14.4439 27.3907C14.1351 27.0819 13.9248 26.6884 13.8396 26.26C13.7544 25.8316 13.7981 25.3876 13.9652 24.9841C14.1324 24.5806 14.4154 24.2357 14.7786 23.993C15.1417 23.7504 15.5687 23.6209 16.0055 23.6209H18.2138V17.7417H16.0055C14.4059 17.7417 12.8423 18.216 11.5123 19.1047C10.1823 19.9934 9.14572 21.2564 8.5336 22.7342C7.92147 24.212 7.76131 25.8382 8.07337 27.407C8.38543 28.9758 9.15569 30.4169 10.2867 31.5479C11.4178 32.679 12.8589 33.4492 14.4277 33.7613C15.9965 34.0733 17.6226 33.9132 19.1004 33.3011C20.5782 32.6889 21.8413 31.6523 22.73 30.3224C23.6186 28.9924 24.093 27.4287 24.093 25.8292V23.6209H18.2138V25.8292Z" fill="white"/>
<path d="M26.2984 14.8001H32.9151V8.91675H26.2984C24.1542 8.91895 22.0984 9.77174 20.5821 11.288C19.0659 12.8042 18.2131 14.86 18.2109 17.0042V17.7417H24.0901V17.0042C24.0912 16.4193 24.3244 15.8587 24.7384 15.4454C25.1524 15.0322 25.7135 14.8001 26.2984 14.8001V14.8001Z" fill="white"/>
<path d="M18.2109 23.6209H24.0901V17.7417H18.2109V23.6209Z" fill="#00EF8B"/>
</g>
<defs>
<clipPath id="clip0_106_24812">
<rect width="100" height="41.6666" fill="white" transform="translate(0 0.166748)"/>
</clipPath>
</defs>
</svg></div></a><nav role="navigation" class="new-navigation-menu w-nav-menu"><div data-hover="false" data-delay="0" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">Solutions</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list w-dropdown-list"><a href="../hybrid-custody.html" class="navigation-dropdown-link w-dropdown-link">Walletless Onboarding +Hybrid Custody</a><a href="http://developers.flow.com/hybrid-custody/guides/account-abstraction" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Account Abstraction</a><a href="https://developers.flow.com/cadence" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Cadence</a></nav></div><div data-hover="false" data-delay="0" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">Developers</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list w-dropdown-list"><a href="https://developers.flow.com/" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Developer portal</a><a href="https://github.com/onflow" class="navigation-dropdown-link w-dropdown-link">GitHub</a></nav></div><div data-hover="false" data-delay="0" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">Ecosystem</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list ecosystem w-dropdown-list"><a href="https://www.flowverse.co/" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Flowverse</a></nav></div><div data-hover="false" data-delay="0" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">Community</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list community w-dropdown-list"><a href="../flow-ambassador-program.html" class="navigation-dropdown-link w-dropdown-link">Ambassador program</a><a href="../blog.html" class="navigation-dropdown-link w-dropdown-link">Blog</a><a href="https://forum.onflow.org/" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Forum</a><a href="https://discord.com/invite/J6fFnh2xx6" target="_blank" class="navigation-dropdown-link discord w-dropdown-link">Discord</a><a href="https://twitter.com/flow_blockchain" class="navigation-dropdown-link twitter w-dropdown-link">Twitter</a></nav></div><div data-hover="false" data-delay="100" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">About</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list ecosystem w-dropdown-list"><a href="../primer.html" class="navigation-dropdown-link w-dropdown-link">Primer</a><a href="../priorities.html" class="navigation-dropdown-link w-dropdown-link">Priorities</a><a href="../use-cases.html" class="navigation-dropdown-link w-dropdown-link">Use Cases</a><a href="../flow-token-economics.html" class="navigation-dropdown-link w-dropdown-link">Token economics</a><a href="../technical-paper.html" class="navigation-dropdown-link w-dropdown-link">Technical papers</a><a href="../sustainability.html" class="navigation-dropdown-link w-dropdown-link">Sustainability</a></nav></div></nav><div class="new-menu-button w-nav-button"><div class="w-icon-nav-menu"></div></div></div></div><div><div class="post-with-image-layout"><div class="blog-post-hero-2 wf-section"><div class="post-container w-container"><div><div class="blog-post-meta-data in-post"><div class="w-dyn-list"><div role="list" class="eng-blog-category-list w-dyn-items"><div role="listitem" class="w-dyn-item"><a href="../engineering-categories/blockchain.html" class="radius-text w-inline-block"><div class="eco-text-2">Blockchain</div></a></div></div></div><div class="small-dot-sep inpost left"></div><div class="blog-post-meta-text-data">February 28, 2022</div></div><div class="main-blog-post-title">Uniswap V2 Explained (Beginner Friendly)</div><div class="blog-post-meta-data post"><a href="../authors/leo-zhang.html" class="blog-post-meta-text-data dark">Leo Zhang</a><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">Flow Builder</div></div></div></div></div><div class="blog-post-section wf-section"><div class="container-25 _1280 w-container"><div class="post-info-parent"><div class="post-share-sidebar"><div class="social-share-btn-2 tw"></div><div class="social-share-btn-2 email"></div><div class="share-text">Share</div></div><div class="post-main-info-div eng"><img loading="lazy" src="#" alt="Uniswap V2 Explained (Beginner Friendly)" class="blog-post-main-image w-dyn-bind-empty"/><div class="blog-post-rich-text-block w-richtext"><figure class="w-richtext-figure-type- "><div><img alt="" src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b346895c9c1a11bfd5e80_1_bpBLtSjIBs26wwonN2UACw.png"/></div><figcaption>(source: <a href="https://twitter.com/VitalikButerin/status/1489998905211195393" target="_blank">https://twitter.com/VitalikButerin/status/1489998905211195393</a>)</figcaption></figure><p>Among those keywords about the core tech and mechanisms in crypto mentioned by Vitalik, what is x*y=k? It looks quite simple. Isn’t it?</p><p>Yes it is. In fact, it’s the formula that drives decentralized exchanges. For instance, It is being used by Uniswap, an active decentralized cryptocurrency exchange on Ethereum.</p><h3>Uniswap</h3><p>Uniswap allows anyone to make market and swap tokens. The first version — Uniswap V1, was released in 2018 as a proof of concept. Version 2 was a production version released in 2020. And Version 3, which is currenty the latest version, was launched in 2021.</p><p>In this blog post, I will explain how Uniswap V2 works with examples that walk through basic scenarios, and how the simple but powerful formula works.</p><p>I believe having a good understanding of Uniswap V2 and its core idea makes it much easier to understand the latest version V3 and the mechanism of other decentralized exchanges.</p><p>Let’s get started.</p><h3>Liquidity Pool</h3><p>Uniswap V2 allows traders to directly swap from one ERC-20 token to another ERC-20 token. Traders don’t trade directly with each other. Instead, they trade with a token pool that has both tokens reserved. This token pool is called “<em>Liquidity Pool</em>”. But the question is where are the tokens reserved in the pool originally from?</p><p>The tokens in the liquidity pool are added by users, called “<em>Liquidity Providers</em>”.</p><p>Why do “Liquidity Provider” add their tokens to Liquidity Pool? Because they can earn fees when traders swap their tokens with the Liquidity Pool. We will see later.</p><p>Each Uniswap liquidity pool is a trading venue for a pair of ERC-20 tokens. Since there are lots of pairs, Uniswap will route the traders and liquidity providers to the corresponding liquidity pool for their transactions.</p><figure class="w-richtext-figure-type- "><div><img alt="" src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b34685b0c7d7ea78f11b6_1_QC-dT9XnjUp5d6k45pND8g.jpg"/></div></figure><p>(source: <a href="https://docs.uniswap.org/protocol/V2/concepts/protocol-overview/how-uniswap-works" target="_blank">https://docs.uniswap.org/protocol/V2/concepts/protocol-overview/how-uniswap-works</a>)</p><p>OK, enough theories. Let’s go through an example as a trader, and see how they swap tokens with Uniswap.</p><h3>Example — Trader Swap Tokens</h3><p>Assume there are two types of ERC-20 tokens: tokenA and tokenB, and there is a Uniswap liquidity pool which has been created for swapping between tokenA and tokenB. We will explain how it is created later. For now, let’s say this tokenA-tokenB liquidity pool currently has 5 tokenA and 20 tokenB in it, so the ratio is 1 tokenA : 4 tokenB. And we assume that’s the current market ratio, meaning 1 tokenA is now worth 4 tokenB.</p><p>OK, now if trader Tim swaps his 1 tokenA for tokenB, the pool will take his 1 tokenA, transfer a certain amount of tokenB from the pool to Tim.</p><p>But how many tokenB will Tim receive after the swap? 4 tokenB? No, he will actually receive a bit less: 3.324996 tokenB instead. Uniswap determines the output token amount by using a constant product formula:</p><div class="w-embed"><pre><code class="language-markup"><!--
X * Y = K
}--!></code></pre></div><p>The constant product formula requires the trades should not change the product (K) of a pair’s reserved balances (X and Y). Let’s walk through the calculation step by step.</p><p>Originally, the liquidity pool has 5 tokenA and 20 tokenB, so X = 5 and Y = 20. when Tim swaps 1 tokenA, he will pay a 0.3% fee first, which is 0.003 tokenA (0.3% * 1). After the fee is paid, the remaining tokenA, which is 0.997 tokenA, will be swapped for tokenB, so the new X becomes 5.997 tokenA. Since K must remain unchanged, the new Y can be calculated from the formula X * Y = newX * newY. So newY is 16.675004 (X * Y / newX = 5 * 20 / 5.997 = 16.675004). This means the pool will hold 16.675004 tokenB, the remaining tokenB will be sent to Tim, which means Tim will receive 3.324996 tokenB (Y — newY = 20 – 16.675004 = 3.324996). After the swap, the pool has 6 tokenA and 16.675004 tokenB.</p><p>There are two things worth to mention in the above example:</p><h3>Fixed rate</h3><p>The fee is a fixed rate for each swap transaction, and is the same for any token pair swapping. As of right now, the rate is fixed as 0.3%. There is also a protocol fee, but it’s set as 0 currently, so I simply ignored it here.</p><h3>V1 formula</h3><p>For simplicity, the calculation steps I’m using here is actually from Uniswap V1, where the trading fee is applied by reducing the amount paid into the contract by 0.3% before enforcing the constant-product invariant:</p><p>Uniswap V2 formula is slightly different from V1 because it supports Flash Swap, which allows more advanced use cases, like borrowing the tokens from the pool first then returning them back within the same transaction. This introduces the possibility that swapping tokenA for tokenB might end up receiving some additional tokenA, in which case fee should also be charged.</p><p>However, our example is a typical use case for traders to swap one token for another, since the end result is the same as using V1’s formula, I decided to explain the calculation with V1’s formula for simplicity.</p><p>If you are interested in the details of V2 formula, you can read its whitepaper and source code linked at the end of this post.</p><h3>The Economic model behind the formula</h3><p>In summary, Tim swapped 1 tokenA for 3.324996 tokenB, and paid 0.003 tokenA as the fee. The swap caused tokenA’s price to drop from 4 tokenB to 3.324996 tokenB. In fact, if Tim continues to swap tokenA for tokenB, tokenA’s price will keep dropping. See the following table for the price change if Tim made 5 transactions to swap 1 tokenA for tokenB each time:</p><figure class="w-richtext-figure-type- "><div><img alt="" src="https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b34684164424483262841_1*J2zE2U-mlxPBjJwONAMBpA.png"/></div></figure><p>Why would tokenA’s price drop when Tim swaps tokenA for tokenB? I think this is to follow the law of supply and demand: selling a token would make its price drop, and buying a token would make its price rise.</p><p>So if Tim was to swap 4 tokenB for tokenA, then he would receive 0.81239531 tokenA, which is calculated as 5 – 5 * 20 / ((20 + 4) — 4 * 0.03) (with V1’s formula). The swap changed tokenA’s price from 4 tokenB to about 4.9237 tokenB (4/0.8124).</p><p>Note, Uniswap also provides public read methods to calculate the exact token amount to be received from swapping:</p><div class="w-embed"><pre><code class="language-markup"><!--
function getAmountOut(
    uint amountIn, 
    uint reserveIn, 
    uint reserveOut) external pure returns (uint amountOut);
}--!></code></pre></div><h3>Market price and Arbitrageurs</h3><p>In the beginning of the example, we assumed the market price of tokenA is the same as the liquidity pool before Tim swaps tokens. In fact, for a popular liquidity pool, the token price usually is very close to the market price.</p><p>Why? Because if the token price is off the market, there will be arbitrageurs acquiring tokens from other market with low cost, and swap with the liquidity pool to make a profit.</p><p>Arbitrageurs are mostly bots. Since decentralized exchanges allow anyone to swap tokens, there are lots of Arbitrageur bots monitoring liquidity pools to find arbitrage opportunities. Therefore, when a trader queries the token price of a liquidity pool, especially for a popular token pair, the price mostly likely matches the market price.</p><h3>Front running</h3><p>The Uniswap transactions can be front run to certain extend. Since miners, who build blocks, can decide the order of transactions in the block they are building. They could add swap transactions before yours (front running) to make a profit.</p><p>In order to minimize the front running issue, Uniswap introduced amountOutMin and deadline arguments to the swap methods, so that if there are front running transactions or race condition that caused the output amount token to be less than the specified amountOutMin, then the transaction would revert, and no token is transferred. In addition to that, if the transaction is included in a block <em>after</em> the specified deadline block, then the transaction would also revert.</p><p>‍</p><div class="w-embed"><pre><code class="language-markup"><!--
function swapExactTokensForTokens(
        uint amountIn,
        uint amountOutMin,
        address[] calldata path,
        address to,
        uint deadline
    ) external returns (uint[] memory amounts);
}--!></code></pre></div><h3>Wrapped Ethereum</h3><p>swapExactTokensForTokens allows traders to swap between ERC-20 tokens. However, it can’t be used to swap between ETH and ERC-20 tokens, because the native ETH token is not a ERC-20 token, as it was built before the ERC-20 standard existed. In order to support ETH-ERC-20 swapping, Uniswap provided swapExactTokensForETH and swapTokensForExactETH methods. They will convert ETH into WETH (wrapped ETH), which is a ERC-20 token, so that the WETH tokens can be used for swapping. And traders can withdraw the original ETH by sending WETH back to the WETH contract.</p><div class="w-embed"><pre><code class="language-markup"><!--
function swapTokensForExactETH(uint amountOut, uint amountInMax, address[] calldata path, address to, uint deadline)
        external
        returns (uint[] memory amounts);
function swapETHForExactTokens(uint amountOut, address[] calldata path, address to, uint deadline)
        external
        payable
        returns (uint[] memory amounts);
}--!></code></pre></div><p>‍</p><h4>In summary,</h4><p>swapExactETHForTokens will deposit ETH to WETH contract and receive WETH tokens, which will then be swapped to other tokens.</p><p>swapExactTokensForETH does the opposite: it swaps input tokens to WETH first, and then withdraw ETH from the WETH contract with the WETH tokens.</p><h3>Liquid Providers</h3><p>OK, we’ve learned what Uniswap V2 provides to allow traders to swap ERC-20 tokens. But this is just one side of the market. Uniswap still needs a way to incentivize someone to deposit their tokens into the liquidity pool so that traders can swap, otherwise the liquidity pool would have no tokens, and no trader would use the contract.</p><p>Uniswap calls them<em> Liquid Providers</em> who are incentivized to deposit tokens into the pool and create the market for traders to swap tokens.</p><p>Uniswap incentivizes liquid providers with a fixed 0.3% fee to be earned for each swap transaction.</p><p>But here are the questions:</p><ol role="list"><li>When does the fee get transferred to the liquid providers?</li><li>If there are multiple liquid providers, how is the fee divided between them?</li><li>How does liquid provider redeem their tokens including the earned fees?</li></ol><p>Instead of answering these question individually, I will walk you through an example with concrete numbers to explain. If you have the same questions as above, keep them in mind when reading through!</p><h3>Example — Liquidity Provider adding Liquidity</h3><h3>Lisa adds liquidity</h3><p>Let’s start from scratch. Initially the tokenA-tokenB pool doesn’t exist. Liquid provider Lisa adds 5 tokenA and 20 tokenB to create this pool. Now the pool has 5 tokenA and 20 tokenB. In return, the pool will mint 10 pool share tokens and transfer them to Lisa as a proof of ownership. Let’s call this pool share tokens “tokenP”.</p><p>TokenP are minted to track the relative proportion of total reserved that each liquidity provider has contributed. Since Lisa is the first and the only liquidity provider of the pool, she owns 100% of the tokens in the pool.</p><p>To make it easy to see how tokens are moved between accounts after each transaction, I made the following table that shows the token ownership changes:</p><figure class="w-richtext-figure-type- "><div><img alt="" src="https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b346873b4b90fb2e7bab2_1*R3fjmkceY6E0dLzuMDSZHA.png"/></div></figure><p>Note, tokenP is also a ERC-20 token, which can also be transferred or swapped, just like any other ERC-20 tokens.</p><p>But why adding 5 tokenA and 20 tokenB would mint 10 tokenP? How is the amount 10 calculated?</p><p>It is calculated as the square root of the input amount of tokenA times the input amount of tokenB, which is the square root of 5 * 20, resulting in10.</p><p>Why did Lisa add tokens with 1:4 ratio? Why not adding 5 tokenA and 10 tokenB instead, which is 1:2 ratio, or some other ratio?</p><p>That’s because Lisa knows 1:4 is the market ratio: 1 tokenA is worth 4 tokenB. If she adds 5 tokenA and 10 tokenB instead, then there will be arbitrageurs swapping tokens thus making a profit until the pool has remaining tokens with a 1:4 ratio. So the first Liquid Provider will add tokens.</p><h3>Lily adds liquidity</h3><p>Now let’s see what happens when there are multiple liquidity providers adding tokens to the liquidity pool.</p><p>If Lily adds 50 tokenA and 200 tokenB to the pool after Lisa, then Lily will receive 100 tokenP, which is the square root of 50 * 200. Since there are additional 100 tokenP minted, the total supply of tokenP has increased to 110, among which Lisa owns about 9.09091% (1/11), and Lily owns the rest 90.90909%(10/11). These percentages will determine how many tokens they can redeem from the pool when they remove liquidity.</p><figure class="w-richtext-figure-type- "><div><img alt="" src="https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b3468651c0a1e563c26c1_1*hTvK4qacveQ_LuGkIucrNg.png"/></div></figure><p>You might wonder, what if Lily tries to be foxy here: what if she adds 25 tokenA and 400 tokenB? Wouldn’t that mint the same amount of tokenP since the square root of 50*200 and 25*400 are the same?</p><p>Uniswap has considered this case and will prevent it by punishment.</p><p>If tokens are added to the pool with a different ratio, then the minted tokens can not accurately represent the liquidity provider’s share. In order to address this issue, Uniswap introduced a rule such that, if the token ratio is different from the existing ratio in the pool, the liquid provider will end up receiving less liquidity tokens as a punishment.</p><p>For instance, since the current token ratio in the pool is 1:4, by adding 25 tokenA and 400 tokenB, Lily will receive the same amount of tokenP as sending 25 tokenA and 100 tokenB, which is only 50 tokenP. Likewise, by adding 100 tokenA and 100 tokenB, she will receive the same amount of tokenP as sending 25 tokenA and 100 tokenB, which is also only 50 tokenP. If the ratio is not the same as what the pool currently has, then there are always some tokens wasted in the sense that those tokens were added to the pool but no additional liquidity tokens were minted to the liquidity provider.</p><p>With this rule, the liquidity providers are incentivized to add tokens at the same ratio as the pool. And we know the rate is always close to the market price otherwise Arbitrageurs will arbitrage if the token ratio was off the market.</p><p>Great! Now both Lisa and Lily have added their pairs of tokens to the liquidity pool and received the liquidity tokens as shares of ownership. Let’s continue to see what happens when tokens in the pool are swapped by Traders.</p><h3>Tim swaps tokens</h3><p>With 55 tokenA and 220 tokenB in the pool, now Trader Tim swaps 10 tokenA which will transfer to him 33.333 tokenB. After the swap, the pool has 65 tokenA and 186.2398 tokenB. We did not repeat the calculation steps here for this swap, since we’ve explained it earlier.</p><figure class="w-richtext-figure-type- "><div><img alt="" src="https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b346859b91c8cf81e35d4_1*QoyX7H-D1qrgO-k3dAE9nQ.png"/></div></figure><h3>Lisa removes liquidity</h3><p>Now Lisa decides to redeem all of her tokens. In order to do that, she needs to call the removeLiquidity method. The removeLiquidity method burns the liquidity tokens in exchange for the underlying tokens. Since Lisa decides to redeem max amount, she transfers to the pool all her 10 tokenP, which will be burned, and Lisa will receive 5.90909 tokenA (65 * 9.090909%) and 16.93089 (186.2398 * 9.090909%) tokenB. After Lisa redeemed her tokens from the pool, now the token has 59.090909 tokenA and 169.30891 tokenB left.</p><figure class="w-richtext-figure-type- "><div><img alt="" src="https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b34685c1ff14b9bbfe5e9_1*Boqp1JhTTsCa59cdo9vwcQ.png"/></div></figure><h3>Lily removes Liquidity</h3><p>After Lisa remove all of her tokens, Lily also decides to redeem. She called removeLiquidity with all her 100 tokenP. The pool burns them and transfer 59.090909 tokenA and 169.30891 tokenB to Lily. Now, the pool has no tokenA and tokenB left (technically there is a tiny amount of each token locked to prevent issues like dividing by 0, but the amount is so small that it could be ignored. If you are interested in those details, you can see them by running my test case posted in the end).</p><p>All right, we’ve walked through the example of adding liquidity to the pool, swapping tokens and removing liquidity from the pool.</p><figure class="w-richtext-figure-type- "><div><img alt="" src="https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b34680c7551e237e97052_1*9flmehJyeVDtmecAKNZkoA.png"/></div></figure><h3>Summary</h3><p>This post explained how the math works in Uniswap V2 contract when tokens are added, swapped and removed from the liquidity pool. There are some details in the calculation that I chose to simplify in order to keep it beginner-friendly. If you are interested in those details, including the actual on-chain calculation that uses uint32 numbers, you can <a href="https://github.com/Uniswap/v2-periphery/blob/master/contracts/UniswapV2Router02.sol" target="_blank">check out contract source code</a>, as well as<a href="https://github.com/zhangchiqing/v2-periphery/blob/master/test/WalkThrough.spec.ts" target="_blank"> my test cases which implemented the above examples</a>.</p><p>Uniswap V2 also provides other features like Flash Swaps, and improves price oracle, etc, which are not covered in this post. If you are interested, you can read <a href="https://uniswap.org/whitepaper.pdf" target="_blank">the whitepaper</a>.</p></div><div class="tags-post-div"><div class="tags-title-14">Tags:</div><div class="w-dyn-list"><div role="list" class="tag-cloud w-dyn-items"><div role="listitem" class="w-dyn-item"><div class="tags-title">Uniswap</div></div><div role="listitem" class="w-dyn-item"><div class="tags-title">Defi</div></div><div role="listitem" class="w-dyn-item"><div class="tags-title">Decentralized Exchange</div></div><div role="listitem" class="w-dyn-item"><div class="tags-title">Cryptocurrency</div></div><div role="listitem" class="w-dyn-item"><div class="tags-title">Blockchain</div></div></div></div></div></div></div></div></div></div><div class="post-with-text-layout hide"><div class="blog-post-hero-2 no-image wf-section"><div class="post-container w-container"><div><div class="blog-post-meta-data in-post"><div class="blog-post-category">Studio</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">03/30/2021</div></div><div class="main-blog-post-title">Welcoming Animoca, MotoGP, and StarGirl to Flow</div><div class="blog-post-meta-data post"><div class="blog-post-meta-text-data dark">Mik Naayem</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">CBO and Cofounder at Dapper Labs</div></div></div></div></div><div class="blog-post-section wf-section"><div class="container-25 _1280 w-container"><div class="post-info-parent no-img"><div class="post-share-sidebar"><div class="social-share-btn-2 tw"></div><div class="social-share-btn-2 email"></div><div class="share-text">Share</div></div><div class="post-main-info-div"><div class="blog-post-rich-text w-richtext"><p>The rich text element allows you to create and format headings, paragraphs, blockquotes, images, and video all in one place instead of having to add and format them individually. Just double-click and easily create content.</p><ul role="list"><li>Decentralized because you can set up a blockchain system so that every entity can only make changes within its predefined purview. Companies can also use permissionless, permissioned, or hybrid-approach blockchains, allowing for useful trade-offs between network security and system privacy.</li><li>Decentralized because you can set up a blockchain system so that every entity can only make changes within its predefined purview. Companies can also use permissionless, permissioned, or hybrid-approach blockchains, allowing for useful trade-offs between network security and system privacy.</li><li>scscsssc</li></ul><h4>Static and dynamic content editing</h4><blockquote>A rich text element can be used with static or dynamic content. For static content, just drop it into any page and begin editing. For dynamic content, add a<a href="http://www.google.com"> rich text field to any collection</a> and then connect a rich text element to that field in the settings panel. Voila!</blockquote><h4>How to customize formatting for each rich text</h4><p>Headings, paragraphs, blockquotes, figures, images, and figure captions can all be styled after a class is added to the rich text element using the &quot;When inside of&quot; nested selector system.</p></div></div></div></div></div></div><div class="section-32 wf-section"><div class="container-25 _1280 w-container"><div class="title-div-3"><div>Related Content</div></div><div class="w-dyn-list"><div role="list" class="w-dyn-items"><div role="listitem" class="w-dyn-item"><div class="blog-post-parant-div first"><div class="blog-post-info-div"><a href="/engineering-blogs/upgrading-flows-consensus-follower-to-boost-attack-resilience-and-processing-speed" class="blog-post-title">Upgrading Flow&#x27;s Consensus Follower to boost attack resilience and processing speed</a><div class="blog-post-meta-data"><div class="blog-post-meta-text-data">May 30, 2023</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">Jordan Schalm</div></div></div></div></div><div role="listitem" class="w-dyn-item"><div class="blog-post-parant-div first"><div class="blog-post-info-div"><a href="/engineering-blogs/jolteon-advancing-flows-consensus-algorithm" class="blog-post-title">Jolteon: Advancing Flow’s consensus algorithm</a><div class="blog-post-meta-data"><div class="blog-post-meta-text-data">Apr 14, 2023</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">Jordan Schalm</div></div></div></div></div><div role="listitem" class="w-dyn-item"><div class="blog-post-parant-div first"><div class="blog-post-info-div"><a href="/engineering-blogs/golang-services-improving-observability" class="blog-post-title">Improving Observability of GoLang Services</a><div class="blog-post-meta-data"><div class="blog-post-meta-text-data">Jan 31, 2023</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">Alexey Ivanov</div></div></div></div></div></div></div></div></div></div><div class="section footer wf-section"><div class="footer-div"><div class="join-text-2 no-hover">Join Flow on</div><a href="https://twitter.com/flow_blockchain" target="_blank" class="join-text-2">Twitter</a><a href="https://discord.com/invite/J6fFnh2xx6" target="_blank" class="join-text-2">Discord</a><a href="https://flow.com/" target="_blank" class="join-text-2">flow.com</a></div></div><div class="new-footer wf-section"><div class="container w-container"><div class="w-layout-grid _3-footer-grid"><div><a id="w-node-ec243fb8-8059-5bdb-528d-ce0b082ca18b-082ca187" href="/" class="footer-logo-link w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63ce603ae36f46f6bb67e51e_flow-logo.svg" loading="lazy" alt="flow logo" class="footer-logo-img"/></a><div class="footer-social-icons"><a href="https://twitter.com/flow_blockchain" target="_blank" class="footer-social-icon w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63cec770abbeba426e358f76_Twitter%20-%20Negative.svg" loading="lazy" alt="social icon"/></a><a href="https://www.instagram.com/flowblockchain" target="_blank" class="footer-social-icon w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63cec770799e2958d15306a0_Instagram%20-%20Negative.svg" loading="lazy" alt="social icon"/></a><a href="https://www.youtube.com/@FlowBlockchain" target="_blank" class="footer-social-icon w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63cec77005a49eaba248e147_YouTube%20-%20Negative.svg" loading="lazy" alt="social icon"/></a><a href="https://t.me/flow_blockchain" target="_blank" class="footer-social-icon w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63cec770b75d5482a08014db_Telegram%20-%20Negative.svg" loading="lazy" alt="social icon"/></a><a href="https://discord.com/invite/J6fFnh2xx6" target="_blank" class="footer-social-icon last w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63d0398494fe5d96e72f4cc0_Social%20Icon.svg" loading="lazy" alt="social icon"/></a></div></div><div id="w-node-_843ebe60-d3a2-032c-780e-737a5989cba0-082ca187"><div class="footer-column-header">Start Building</div><a href="https://developers.flow.com/" target="_blank" class="new-footer-link">Developer portal</a><a href="https://github.com/onflow" target="_blank" class="new-footer-link">GitHub</a></div><div id="w-node-ec243fb8-8059-5bdb-528d-ce0b082ca19f-082ca187"><div class="footer-column-header">Flow</div><a href="https://docs.google.com/forms/d/e/1FAIpQLSer5ZX0pRWsXF0U0bsgW4Zo8Pmlw0V927ZydDq_ej-qyIJ9_A/viewform" target="_blank" class="new-footer-link">Business Development</a><a href="https://flow.com/node-operation" target="_blank" class="new-footer-link">Node Operation</a><a href="/token-distribution" class="new-footer-link">Token Distribution</a><a href="/mediakit" class="new-footer-link">Media Kit</a><a href="/careers" class="new-footer-link">Careers</a><a href="/faq" class="new-footer-link">FAQ</a></div><div id="w-node-ec243fb8-8059-5bdb-528d-ce0b082ca198-082ca187"><div class="footer-column-header">Get Connected</div><a href="https://port.onflow.org/" target="_blank" class="new-footer-link">Flow Port</a><a href="https://www.flowverse.co/" target="_blank" class="new-footer-link">Flowverse</a></div></div><div class="div-block-129"><div class="footer-copyright">© 2023 All Rights Reserved</div></div></div></div><script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=5f734f4dbd95382f4fdfa0ea" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script><script src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/js/webflow.2724f1538.js" type="text/javascript"></script><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NHJB3BPPXG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NHJB3BPPXG');
</script>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PWSGFLB"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --><script src="../../cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="../../cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/unescaped-markup/prism-unescaped-markup.min.js"></script></body>
<!-- Mirrored from flow.com/engineering-blogs/uniswap-v2-explained-beginner-friendly by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 22 Jul 2023 16:25:24 GMT -->
</html>