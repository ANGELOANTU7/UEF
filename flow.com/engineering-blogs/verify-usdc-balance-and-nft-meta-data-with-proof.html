<!DOCTYPE html><!-- This site was created in Webflow. https://www.webflow.com --><!-- Last Published: Mon Jul 17 2023 22:17:53 GMT+0000 (Coordinated Universal Time) --><html data-wf-domain="flow-com.webflow.io" data-wf-page="637380c394c328ab5ad74bb3" data-wf-site="5f734f4dbd95382f4fdfa0ea" lang="en">
<!-- Mirrored from flow.com/engineering-blogs/verify-usdc-balance-and-nft-meta-data-with-proof by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 22 Jul 2023 16:22:59 GMT -->
<head><meta charset="utf-8"/><title>Verify USDC Balance and NFT Meta Data with Proof</title><meta content="Aug 17, 2022" name="description"/><meta content="Verify USDC Balance and NFT Meta Data with Proof" property="og:title"/><meta content="Aug 17, 2022" property="og:description"/><meta content="" property="og:image"/><meta content="Verify USDC Balance and NFT Meta Data with Proof" property="twitter:title"/><meta content="Aug 17, 2022" property="twitter:description"/><meta content="" property="twitter:image"/><meta property="og:type" content="website"/><meta content="summary_large_image" name="twitter:card"/><meta content="width=device-width, initial-scale=1" name="viewport"/><meta content="goOrjM0FiQtmK2lUJ9Y5NpPJA-fMUUc_6Q6Vmd7-XIY" name="google-site-verification"/><meta content="Webflow" name="generator"/><link href="../../assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/css/flow-com.webflow.9325b97a3.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/" rel="preconnect"/><link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin="anonymous"/><script src="../../ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script><script type="text/javascript">WebFont.load({  google: {    families: ["Epilogue:300,regular,500,600,700,800,900,italic"]  }});</script><script src="../../use.typekit.net/mgu2ukv.js" type="text/javascript"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script><script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script><link href="../../assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/616b1520779838b5f9174363_favicon.png" rel="shortcut icon" type="image/x-icon"/><link href="../../assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/616b1548fd01d005fc2bc2c7_logo256.png" rel="apple-touch-icon"/><link href="verify-usdc-balance-and-nft-meta-data-with-proof.html" rel="canonical"/><style>
  .w-webflow-badge {
    display: none !important;
  }
</style>


<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'../../www.googletagmanager.com/gtm5445.html?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PWSGFLB');</script>
<!-- End Google Tag Manager -->


<meta name="facebook-domain-verification" content="dhlb5fcuitl7owilmsg6xh307ohoyc" />

<!-- Hotjar Tracking Code for Flow.com -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:3329982,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
<link rel="stylesheet" href="../../cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" /></head><body><div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="navigation w-nav"><div class="nav-container w-container"><a href="../index.html" class="nav-logo-div w-nav-brand"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63ce603ae36f46f6bb67e51e_flow-logo.svg" loading="lazy" alt="flow logo" class="hide"/><div aria-label="Flow logo" class="nav-logo__embed w-embed"><svg width="100" height="42" viewBox="0 0 100 42" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_106_24812)">
<path class="logotype" d="M57.3672 20.9501H54.6797V30.971H50.9297V20.9501H48.9922V17.7376H50.9297V16.4876C50.9297 13.2501 52.9505 11.5876 56.0214 11.5876C56.4968 11.5916 56.9705 11.6475 57.4339 11.7543V15.5043C57.0296 15.3422 56.5985 15.2574 56.163 15.2543C55.9663 15.2387 55.7684 15.2659 55.5832 15.334C55.3979 15.4021 55.2296 15.5096 55.0899 15.6489C54.9501 15.7883 54.8422 15.9563 54.7735 16.1414C54.7049 16.3264 54.6771 16.5242 54.6922 16.721V17.7168H57.3797L57.3672 20.9501ZM63.013 30.971H59.2214V11.871H63.013V30.971Z" fill="black"/>
<path class="logotype" d="M71.4292 16.9085C72.851 16.906 74.2415 17.3255 75.4247 18.1139C76.6079 18.9023 77.5306 20.024 78.0758 21.3371C78.6211 22.6502 78.7644 24.0956 78.4876 25.4902C78.2108 26.8848 77.5264 28.1658 76.5211 29.1712C75.5157 30.1766 74.2346 30.861 72.84 31.1377C71.4454 31.4145 70.0001 31.2712 68.687 30.726C67.3739 30.1807 66.2521 29.2581 65.4638 28.0749C64.6754 26.8917 64.2559 25.5011 64.2584 24.0793C64.2466 23.1344 64.4241 22.1967 64.7803 21.3213C65.1365 20.446 65.6642 19.6508 66.3325 18.9826C67.0007 18.3144 67.7959 17.7866 68.6712 17.4304C69.5465 17.0742 70.4842 16.8968 71.4292 16.9085V16.9085ZM71.4292 27.596C73.3667 27.596 74.7625 25.9877 74.7625 24.0793C74.7834 23.6288 74.7126 23.1787 74.5544 22.7563C74.3963 22.3339 74.1541 21.9481 73.8424 21.622C73.5308 21.296 73.1562 21.0366 72.7414 20.8595C72.3266 20.6824 71.8802 20.5914 71.4292 20.5918C70.5213 20.6232 69.661 21.0058 69.0298 21.6592C68.3986 22.3125 68.0458 23.1855 68.0458 24.0939C68.0458 25.0024 68.3986 25.8753 69.0298 26.5286C69.661 27.182 70.5213 27.5647 71.4292 27.596Z" fill="black"/>
<path class="logotype" d="M82.5576 17.1875L84.9951 26.3542L87.4326 19.0708L86.7659 17.1917H90.5159L93.7284 26.3583L96.1076 17.1917H99.9992L95.9034 30.975H91.9701L89.2284 23.4167L86.6659 30.9708H82.7076L78.6367 17.1875H82.5576Z" fill="black"/>
<path d="M20.8333 41.8334C32.3393 41.8334 41.6667 32.506 41.6667 21.0001C41.6667 9.49415 32.3393 0.166748 20.8333 0.166748C9.3274 0.166748 0 9.49415 0 21.0001C0 32.506 9.3274 41.8334 20.8333 41.8334Z" fill="#00EF8B"/>
<path d="M29.9732 17.7417H24.0898V23.625H29.9732V17.7417Z" fill="white"/>
<path d="M18.2138 25.8292C18.2138 26.266 18.0843 26.6929 17.8416 27.0561C17.599 27.4192 17.2541 27.7023 16.8506 27.8694C16.447 28.0366 16.003 28.0803 15.5746 27.9951C15.1463 27.9099 14.7528 27.6996 14.4439 27.3907C14.1351 27.0819 13.9248 26.6884 13.8396 26.26C13.7544 25.8316 13.7981 25.3876 13.9652 24.9841C14.1324 24.5806 14.4154 24.2357 14.7786 23.993C15.1417 23.7504 15.5687 23.6209 16.0055 23.6209H18.2138V17.7417H16.0055C14.4059 17.7417 12.8423 18.216 11.5123 19.1047C10.1823 19.9934 9.14572 21.2564 8.5336 22.7342C7.92147 24.212 7.76131 25.8382 8.07337 27.407C8.38543 28.9758 9.15569 30.4169 10.2867 31.5479C11.4178 32.679 12.8589 33.4492 14.4277 33.7613C15.9965 34.0733 17.6226 33.9132 19.1004 33.3011C20.5782 32.6889 21.8413 31.6523 22.73 30.3224C23.6186 28.9924 24.093 27.4287 24.093 25.8292V23.6209H18.2138V25.8292Z" fill="white"/>
<path d="M26.2984 14.8001H32.9151V8.91675H26.2984C24.1542 8.91895 22.0984 9.77174 20.5821 11.288C19.0659 12.8042 18.2131 14.86 18.2109 17.0042V17.7417H24.0901V17.0042C24.0912 16.4193 24.3244 15.8587 24.7384 15.4454C25.1524 15.0322 25.7135 14.8001 26.2984 14.8001V14.8001Z" fill="white"/>
<path d="M18.2109 23.6209H24.0901V17.7417H18.2109V23.6209Z" fill="#00EF8B"/>
</g>
<defs>
<clipPath id="clip0_106_24812">
<rect width="100" height="41.6666" fill="white" transform="translate(0 0.166748)"/>
</clipPath>
</defs>
</svg></div></a><nav role="navigation" class="new-navigation-menu w-nav-menu"><div data-hover="false" data-delay="0" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">Solutions</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list w-dropdown-list"><a href="../hybrid-custody.html" class="navigation-dropdown-link w-dropdown-link">Walletless Onboarding +Hybrid Custody</a><a href="http://developers.flow.com/hybrid-custody/guides/account-abstraction" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Account Abstraction</a><a href="https://developers.flow.com/cadence" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Cadence</a></nav></div><div data-hover="false" data-delay="0" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">Developers</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list w-dropdown-list"><a href="https://developers.flow.com/" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Developer portal</a><a href="https://github.com/onflow" class="navigation-dropdown-link w-dropdown-link">GitHub</a></nav></div><div data-hover="false" data-delay="0" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">Ecosystem</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list ecosystem w-dropdown-list"><a href="https://www.flowverse.co/" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Flowverse</a></nav></div><div data-hover="false" data-delay="0" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">Community</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list community w-dropdown-list"><a href="../flow-ambassador-program.html" class="navigation-dropdown-link w-dropdown-link">Ambassador program</a><a href="../blog.html" class="navigation-dropdown-link w-dropdown-link">Blog</a><a href="https://forum.onflow.org/" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Forum</a><a href="https://discord.com/invite/J6fFnh2xx6" target="_blank" class="navigation-dropdown-link discord w-dropdown-link">Discord</a><a href="https://twitter.com/flow_blockchain" class="navigation-dropdown-link twitter w-dropdown-link">Twitter</a></nav></div><div data-hover="false" data-delay="100" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">About</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list ecosystem w-dropdown-list"><a href="../primer.html" class="navigation-dropdown-link w-dropdown-link">Primer</a><a href="../priorities.html" class="navigation-dropdown-link w-dropdown-link">Priorities</a><a href="../use-cases.html" class="navigation-dropdown-link w-dropdown-link">Use Cases</a><a href="../flow-token-economics.html" class="navigation-dropdown-link w-dropdown-link">Token economics</a><a href="../technical-paper.html" class="navigation-dropdown-link w-dropdown-link">Technical papers</a><a href="../sustainability.html" class="navigation-dropdown-link w-dropdown-link">Sustainability</a></nav></div></nav><div class="new-menu-button w-nav-button"><div class="w-icon-nav-menu"></div></div></div></div><div><div class="post-with-image-layout"><div class="blog-post-hero-2 wf-section"><div class="post-container w-container"><div><div class="blog-post-meta-data in-post"><div class="w-dyn-list"><div role="list" class="eng-blog-category-list w-dyn-items"><div role="listitem" class="w-dyn-item"><a href="../engineering-categories/blockchain.html" class="radius-text w-inline-block"><div class="eco-text-2">Blockchain</div></a></div><div role="listitem" class="w-dyn-item"><a href="../engineering-categories/smart-contracts.html" class="radius-text w-inline-block"><div class="eco-text-2">Smart Contracts</div></a></div></div></div><div class="small-dot-sep inpost left"></div><div class="blog-post-meta-text-data">August 17, 2022</div></div><div class="main-blog-post-title">Verify USDC Balance and NFT Meta Data with Proof</div><div class="blog-post-meta-data post"><a href="../authors/leo-zhang.html" class="blog-post-meta-text-data dark">Leo Zhang</a><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">Flow Builder</div></div></div></div></div><div class="blog-post-section wf-section"><div class="container-25 _1280 w-container"><div class="post-info-parent"><div class="post-share-sidebar"><div class="social-share-btn-2 tw"></div><div class="social-share-btn-2 email"></div><div class="share-text">Share</div></div><div class="post-main-info-div eng"><img loading="lazy" src="#" alt="Verify USDC Balance and NFT Meta Data with Proof" class="blog-post-main-image w-dyn-bind-empty"/><div class="blog-post-rich-text-block w-richtext"><p><a href="https://medium.com/@chiqing/verify-ethereum-smart-contract-state-with-proof-1a8a0b4c8008">In previous blog post</a> of the series about Ethereum storage (see full list of posts at the end), we explained how Ethereum storage works for simple contract with fix sized variables.</p><p>In this blog post, I will continue explain how dynamic sized variables like map and array works, and we will also walk through real world examples to explain and test cases to verify the formula.</p><p>‍</p><h4>Dynamic Sized Data Structure</h4><p>Ethereum storages values in 32 bytes wide slots. Slots are indexed by a uint256 number.</p><p>For static sized variables, they are stored sequentially in slots.</p><p>Note, the slot index is not a global index, but relative within a smart contract. Each contracts stores variables sequentially from slot 0 (slot index is 0):</p><figure class="w-richtext-figure-type- w-richtext-align-fullwidth" style="max-width:1296pxpx" class="w-richtext-align-fullwidth"><div><img alt="" src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/6373815494c3284922d75441_636a3c2570681a3171fdd233_1_YGiXY8OyQ_32xGbNoKv3iQ.png"/></div><figcaption>Slot index is relative within a contract</figcaption></figure><p>However, for dynamic sized data structure like map or array, the storage position of their items can not be stored sequentially in slots. Instead, the slot position for items is calculated using some formulas based on item key in a map or item index in an array.</p><p>Let’s go through each of them.</p><p>‍</p><h4>Slot Index for Key Value Pair in a Map</h4><p>For map, the slot index for each item (key-value pair) is calculated as:</p><div class="w-embed"><pre><code class="language-markup"><!--
slotIndexForValueN = keccak(keyN ++ M)
--!></code></pre></div><ul role="list"><li>(keyN, valueN) is the key value pair in the map variable</li><li>++ means string concatenation.</li><li>M is the slot index for the map variable.</li><li>keccak is the hash function</li><li>The following diagram shows how the key-value pair is stored in slots.</li></ul><figure class="w-richtext-figure-type- w-richtext-align-fullwidth" style="max-width:1400pxpx" class="w-richtext-align-fullwidth"><div><img alt="" src="https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/63738153583d010f58e6ff26_636a3c25503a5b17bb5fa451_1*hczeC70-JA05mitAQ-6hAw.png"/></div><figcaption>Slot index for key-value pair in a map</figcaption></figure><p>Let’s look at a real world example and verify the above formula.</p><p><a href="https://github.com/centrehq/centre-tokens/blob/master/contracts/v1/FiatTokenV1.sol#L47" target="_blank">The USDC contract uses a map variable</a> to store each USDC holder’s balance. The key is the USDC holder’s address, the value is a uint256 value as the holder’s USDC balance:</p><div class="w-embed"><pre><code class="language-markup"><!--
contract FiatTokenV1 ... {
...    
mapping(address => uint256) internal balances;
...
}
--!></code></pre></div><p>How to get the storage location for a certain account’s USDC balance? For instance the USDC balance of account 0x467d543e5e4e41aeddf3b6d1997350dd9820a173. Let’s just call this account, account K.</p><p>According to the formula, in order to know the slotIndex for the this account, we need to know the map key, which is the account address 0x467d543e5e4e41aeddf3b6d1997350dd9820a173.</p><p>And we need to know the slot index for the map variable, which is 9. How do we know that? I will explain later.</p><p>With these data, let’s compute the slot index for the account’s USDC balance:</p><div class="w-embed"><pre><code class="language-markup"><!--
slotIndexForAccount = keccak(
000000000000000000000000467d543e5e4e41aeddf3b6d1997350dd9820a173 ++ 
0000000000000000000000000000000000000000000000000000000000000009)
--!></code></pre></div><p>Note that both the key and the slot index for the map variable needs to be 32 bytes long left padded with zeros before passing to the keccak hash function.</p><p>The computed slot index for account 0x467d543e5e4e41aeddf3b6d1997350dd9820a173is 0x4065d4ec50c2a4fc400b75cca2760227b773c3e315ed2f2a7784cd505065cb07.</p><p>With the slot index, we can query the proof from a full node using eth_getProof method and verify it:</p><div class="w-embed"><pre><code class="language-markup"><!--
curl https://eth-mainnet.g.alchemy.com/v2/<api_key> \
  -X POST \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","method":"eth_getProof","params":
["0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",
["0x4065d4ec50c2a4fc400b75cca2760227b773c3e315ed2f2a7784cd505065cb07"
], "0xE89EC8"],"id":1}'
--!></code></pre></div><ul role="list"><li>0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48 is the USDC contract address.</li><li>0x4065d4ec50c2a4fc400b75cca2760227b773c3e315ed2f2a7784cd505065cb07 is the slot index of the USDC balance of account 0x467d543e5e4e41aeddf3b6d1997350dd9820a173.</li></ul><p>With the Merkle proof, we can verify it by creating a Merkle trie in local and traversing the path from the root node with contract storage root hash, which is included in the proof, all the way to the leaf node. We have explained this <a href="https://medium.com/@chiqing/verify-ethereum-smart-contract-state-with-proof-1a8a0b4c8008">in previous blog post.</a> The detail can be found in the source code linked at the end of this blog post.</p><p>The storage value is 140080592961691. After verifying the proof, if it’s valid, then we know the USDC balance, which is 140,080,592.961691 USDC token at block 15245000 (0xE89EC8).</p><p>‍</p><h4>Finding the slot index for a map variable</h4><p>OK. Let’s go back to the previous question, how did we know the slot index for the map variable balances is 9?</p><p>We could use a brutal force approach to find it.</p><p>Since contract variables are stored in each slot sequentially, we could iterate through each slot index starting from 0. For each slot index, we assume the target map variable is stored in that slot, and use the formula to get the slot index for the balance of an account, and then use the eth_getStorageAt method to get the value stored at that position within the contract.</p><p>If the slot index is incorrect, then it will return 0, meaning nothing is stored at that location, and we should try another slot index.</p><p>If the slot index is correct, then it should return the balance, and we can simply verify it against the balanceOf interface method call.</p><p>This is one way to find slot index for a state variable. Although not very efficient, it’s probably enough, since a smart contract can’t define too many variables. And you only need to iterate through once, once you have found the slot index, you can save it to use for next time, since smart contract can’t be updated after deployed.</p><p>OK, we’ve explained how dynamic sized variable like map stores its items (key-value pairs). Next let’s take a look another dynamic sized data structure — Array.</p><h4>Slot Index for array item</h4><p>For array variable, the slot index for each array item is calculated as:</p><div class="w-embed"><pre><code class="language-markup"><!--
slotIndexForItemN = keccak(A) + (itemIndex * itemSize)
--!></code></pre></div><ul role="list"><li>A is the slot index of an array variable</li><li>itemIndex is the index of the item.</li><li>itemSize is the number of word (32 bytes) each item takes.</li><li>The following diagram shows how array items are stored in contract slots, if each array item is 64 bytes long, which takes 2 slots to store:</li></ul><figure class="w-richtext-figure-type- w-richtext-align-fullwidth" style="max-width:1400pxpx" class="w-richtext-align-fullwidth"><div><img alt="" src="https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/63738153ceeed77e0510b524_636a3c25dae2e9db6a933842_1*bMEoDzbhsH0n7LD_8WGGSw.png"/></div><figcaption>Sot index for array item if itemSize = 2</figcaption></figure><p>And the array length is stored at the slot index of the array variable, and then all the array items are stores sequentially from the slot at the hash of the slot index of the array.</p><p>Let’s look at another real world example and verify the above formula.</p><p>This time, we will dive into the popular NFT contract — <a href="https://www.cryptokitties.co/" target="_blank">CryptoKitties</a>.</p><p><a href="https://etherscan.io/token/0x06012c8cf97bead5deae237070f9587f8e7a266d#code" target="_blank">CryptoKitties smart contract uses an array variable</a>, called kitties, to store the meta data for each crypto kitty:</p><div class="w-embed"><pre><code class="language-markup"><!--
contract KittyBase is KittyAccessControl {
 ...  Kitty[] kitties; 
 ...
}
--!></code></pre></div><p>‍<br/></p><p>We will explain the Kitty data structure later.</p><p>The slot index for the kitties variable is 6, which can be found using the same approach I explained earlier.</p><p>Now we can query the kitty count, which is the length of the kitties array from slot 6 using eth_getProof.</p><div class="w-embed"><pre><code class="language-markup"><!--
curl https://eth-mainnet.g.alchemy.com/v2/<api_key> \
 -X POST \ 
 -H "Content-Type: application/json" \
 -d '{"jsonrpc":"2.0","method":"eth_getProof","params":
["0x06012c8cf97BEaD5deAe237070F9587f8E7A266d",["0x6"], 
"0xE89D2E"],"id":1}'
--!></code></pre></div><ul role="list"><li>0x06012c8cf97BEaD5deAe237070F9587f8E7A266d is CryptoKitties’s Core contract address, which stores the kitties variable</li><li>0x6 is the slot index of kitties in hex format.</li></ul><p>It returns the storage value as 0x1eb82c, meaning there are a total of 2013228 kitties at block 15244590 (0xE89D2E).</p><h4>Storage Location for each crypto kitty’s meta data</h4><p>Now let’s look at how to get each kitty data from the kitties array.</p><p>Kitty is a struct that takes two words, meaning, each kitty data will take two slots to store. The first slot stores the kitty genes, which is a uint256 number, and the second slot stores the rest of the kitty’s properties:</p><div class="w-embed"><pre><code class="language-markup"><!--
struct Kitty {  
uint256 genes;  
uint64 birthTime;  
uint64 cooldownEndBlock;  
uint32 matronId;  
uint32 sireId;  
uint32 siringWithId;  
uint16 cooldownIndex;  
uint16 generation; 
}
--!></code></pre></div><p>Since each array item is stored sequentially starting from the first item, we can calculate that Kitty 1, for instance, will be stored at slot index: 1.</p><div class="w-embed"><pre><code class="language-markup"><!--
slotIndexForKitty1 = keccak(
0000000000000000000000000000000000000000000000000000000000000006) +
(1 * 2))
--!></code></pre></div><ul role="list"><li>0000000000000000000000000000000000000000000000000000000000000006 is the slot index for the kitties variable in hex format left padded with zeros</li><li>1 is the kitty 1’s index in kitties array;</li><li>2 is the size of the Kitty struct.</li><li>+ is the number addition operation.</li></ul><p>So the slot index for Kitty 1 is 111414077815863400510004064629973595961579173665589224203503662149373724986689 , a very big number.</p><p>With the slot index, we can request proof for the storage data the same way as for the USDC account balance example explained earlier:</p><div class="w-embed"><pre><code class="language-markup"><!--
curl https://eth-mainnet.g.alchemy.com/v2/<api_key> \
  -X POST \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","method":"eth_getProof","params":
["0x06012c8cf97BEaD5deAe237070F9587f8E7A266d",
["0xf652222313e28459528d920b65115c16c04f3efc82aaedc97be59f3f377c0d41"], 
"0xE89D2E"],"id":1}'
--!></code></pre></div><ul role="list"><li>0x06012c8cf97BEaD5deAe237070F9587f8E7A266d is CryptoKitties’s Core contract address.</li><li>0xf652222313e28459528d920b65115c16c04f3efc82aaedc97be59f3f377c0d41 is the hex format of the slot index for Kitty 1.</li><li>0xE89D2E is block 15244590 .</li></ul><p>The above query should show the storage value for Kitty 1 at the first slot is 0x5ad2b318e6724ce4b9290146531884721ad18c63298a5308a55ad6b6b58d. This is the hex format of the Kitty 1’s genes — 626837621154801616088980922659877168609154386318304496692374110716999053, which is a uint256 number.</p><p>If we use CryptoKitties’ getKitty method to query Kitty 1’s genes on <a href="https://etherscan.io/address/0x06012c8cf97bead5deae237070f9587f8e7a266d#readContract" target="_blank">Etherscan</a>, it should return us the same number.</p><h4>Summary</h4><p>In this tutorial, we explained how dynamic sized variable is stored in smart contract, such as map and array. And how to query the contract variable from storage and how to verify the proof for the storage value.</p><p>This is the last blog post of the full series about Ethereum storage. This is the full list of blog posts:</p><ul role="list"><li><a href="https://medium.com/@chiqing/merkle-patricia-trie-explained-ae3ac6a7e123"><em>Merkle Patricia Trie Explained</em></a></li><li><a href="https://medium.com/@chiqing/verify-ethereum-account-balance-with-state-proof-83b51ceb15cf"><em>Verify Ethereum Account Balance with State Proof</em></a></li><li><a href="https://medium.com/@chiqing/eip-1186-explained-the-standard-for-getting-account-proof-444bc1e12e03"><em>EIP 1186 — the standard for getting account proof</em></a></li><li><a href="https://medium.com/@chiqing/verify-ethereum-smart-contract-state-with-proof-1a8a0b4c8008"><em>Verify Ethereum Smart Contract State with Proof</em></a></li><li><a href="https://medium.com/@chiqing/verify-usdc-balance-and-nft-meta-data-with-proof-3b4d065ae923"><em>Verify USDC Balance and NFT Meta Data with Proof</em></a></li></ul><h4>References</h4><ul role="list"><li><a href="https://docs.soliditylang.org/en/v0.8.13/internals/layout_in_storage.html" target="_blank">https://docs.soliditylang.org/en/v0.8.13/internals/layout_in_storage.html</a></li></ul><h4>Source code</h4><p>The source code of the above code and test cases are open sourced as below:</p><ul role="list"><li><a href="https://github.com/zhangchiqing/merkle-patricia-trie/blob/master/erc20_proof_test.go" target="_blank">Test cases for verifying USDC balance of an account with proof</a></li><li><a href="https://github.com/zhangchiqing/merkle-patricia-trie/blob/master/kitties_proof_test.go" target="_blank">Test cases for verifying CryptoKitties Meta data with proof</a></li></ul><p>‍</p></div><div class="tags-post-div"><div class="tags-title-14">Tags:</div><div class="w-dyn-list"><div role="list" class="tag-cloud w-dyn-items"><div role="listitem" class="w-dyn-item"><div class="tags-title">Ethereum</div></div><div role="listitem" class="w-dyn-item"><div class="tags-title">Nft</div></div><div role="listitem" class="w-dyn-item"><div class="tags-title">Solidity</div></div><div role="listitem" class="w-dyn-item"><div class="tags-title">Blockchain Technology</div></div><div role="listitem" class="w-dyn-item"><div class="tags-title">Web 3</div></div></div></div></div></div></div></div></div></div><div class="post-with-text-layout hide"><div class="blog-post-hero-2 no-image wf-section"><div class="post-container w-container"><div><div class="blog-post-meta-data in-post"><div class="blog-post-category">Studio</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">03/30/2021</div></div><div class="main-blog-post-title">Welcoming Animoca, MotoGP, and StarGirl to Flow</div><div class="blog-post-meta-data post"><div class="blog-post-meta-text-data dark">Mik Naayem</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">CBO and Cofounder at Dapper Labs</div></div></div></div></div><div class="blog-post-section wf-section"><div class="container-25 _1280 w-container"><div class="post-info-parent no-img"><div class="post-share-sidebar"><div class="social-share-btn-2 tw"></div><div class="social-share-btn-2 email"></div><div class="share-text">Share</div></div><div class="post-main-info-div"><div class="blog-post-rich-text w-richtext"><p>The rich text element allows you to create and format headings, paragraphs, blockquotes, images, and video all in one place instead of having to add and format them individually. Just double-click and easily create content.</p><ul role="list"><li>Decentralized because you can set up a blockchain system so that every entity can only make changes within its predefined purview. Companies can also use permissionless, permissioned, or hybrid-approach blockchains, allowing for useful trade-offs between network security and system privacy.</li><li>Decentralized because you can set up a blockchain system so that every entity can only make changes within its predefined purview. Companies can also use permissionless, permissioned, or hybrid-approach blockchains, allowing for useful trade-offs between network security and system privacy.</li><li>scscsssc</li></ul><h4>Static and dynamic content editing</h4><blockquote>A rich text element can be used with static or dynamic content. For static content, just drop it into any page and begin editing. For dynamic content, add a<a href="http://www.google.com"> rich text field to any collection</a> and then connect a rich text element to that field in the settings panel. Voila!</blockquote><h4>How to customize formatting for each rich text</h4><p>Headings, paragraphs, blockquotes, figures, images, and figure captions can all be styled after a class is added to the rich text element using the &quot;When inside of&quot; nested selector system.</p></div></div></div></div></div></div><div class="section-32 wf-section"><div class="container-25 _1280 w-container"><div class="title-div-3"><div>Related Content</div></div><div class="w-dyn-list"><div role="list" class="w-dyn-items"><div role="listitem" class="w-dyn-item"><div class="blog-post-parant-div first"><div class="blog-post-info-div"><a href="/engineering-blogs/upgrading-flows-consensus-follower-to-boost-attack-resilience-and-processing-speed" class="blog-post-title">Upgrading Flow&#x27;s Consensus Follower to boost attack resilience and processing speed</a><div class="blog-post-meta-data"><div class="blog-post-meta-text-data">May 30, 2023</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">Jordan Schalm</div></div></div></div></div><div role="listitem" class="w-dyn-item"><div class="blog-post-parant-div first"><div class="blog-post-info-div"><a href="/engineering-blogs/jolteon-advancing-flows-consensus-algorithm" class="blog-post-title">Jolteon: Advancing Flow’s consensus algorithm</a><div class="blog-post-meta-data"><div class="blog-post-meta-text-data">Apr 14, 2023</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">Jordan Schalm</div></div></div></div></div><div role="listitem" class="w-dyn-item"><div class="blog-post-parant-div first"><div class="blog-post-info-div"><a href="/engineering-blogs/golang-services-improving-observability" class="blog-post-title">Improving Observability of GoLang Services</a><div class="blog-post-meta-data"><div class="blog-post-meta-text-data">Jan 31, 2023</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">Alexey Ivanov</div></div></div></div></div></div></div></div></div></div><div class="section footer wf-section"><div class="footer-div"><div class="join-text-2 no-hover">Join Flow on</div><a href="https://twitter.com/flow_blockchain" target="_blank" class="join-text-2">Twitter</a><a href="https://discord.com/invite/J6fFnh2xx6" target="_blank" class="join-text-2">Discord</a><a href="https://flow.com/" target="_blank" class="join-text-2">flow.com</a></div></div><div class="new-footer wf-section"><div class="container w-container"><div class="w-layout-grid _3-footer-grid"><div><a id="w-node-ec243fb8-8059-5bdb-528d-ce0b082ca18b-082ca187" href="/" class="footer-logo-link w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63ce603ae36f46f6bb67e51e_flow-logo.svg" loading="lazy" alt="flow logo" class="footer-logo-img"/></a><div class="footer-social-icons"><a href="https://twitter.com/flow_blockchain" target="_blank" class="footer-social-icon w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63cec770abbeba426e358f76_Twitter%20-%20Negative.svg" loading="lazy" alt="social icon"/></a><a href="https://www.instagram.com/flowblockchain" target="_blank" class="footer-social-icon w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63cec770799e2958d15306a0_Instagram%20-%20Negative.svg" loading="lazy" alt="social icon"/></a><a href="https://www.youtube.com/@FlowBlockchain" target="_blank" class="footer-social-icon w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63cec77005a49eaba248e147_YouTube%20-%20Negative.svg" loading="lazy" alt="social icon"/></a><a href="https://t.me/flow_blockchain" target="_blank" class="footer-social-icon w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63cec770b75d5482a08014db_Telegram%20-%20Negative.svg" loading="lazy" alt="social icon"/></a><a href="https://discord.com/invite/J6fFnh2xx6" target="_blank" class="footer-social-icon last w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63d0398494fe5d96e72f4cc0_Social%20Icon.svg" loading="lazy" alt="social icon"/></a></div></div><div id="w-node-_843ebe60-d3a2-032c-780e-737a5989cba0-082ca187"><div class="footer-column-header">Start Building</div><a href="https://developers.flow.com/" target="_blank" class="new-footer-link">Developer portal</a><a href="https://github.com/onflow" target="_blank" class="new-footer-link">GitHub</a></div><div id="w-node-ec243fb8-8059-5bdb-528d-ce0b082ca19f-082ca187"><div class="footer-column-header">Flow</div><a href="https://docs.google.com/forms/d/e/1FAIpQLSer5ZX0pRWsXF0U0bsgW4Zo8Pmlw0V927ZydDq_ej-qyIJ9_A/viewform" target="_blank" class="new-footer-link">Business Development</a><a href="https://flow.com/node-operation" target="_blank" class="new-footer-link">Node Operation</a><a href="/token-distribution" class="new-footer-link">Token Distribution</a><a href="/mediakit" class="new-footer-link">Media Kit</a><a href="/careers" class="new-footer-link">Careers</a><a href="/faq" class="new-footer-link">FAQ</a></div><div id="w-node-ec243fb8-8059-5bdb-528d-ce0b082ca198-082ca187"><div class="footer-column-header">Get Connected</div><a href="https://port.onflow.org/" target="_blank" class="new-footer-link">Flow Port</a><a href="https://www.flowverse.co/" target="_blank" class="new-footer-link">Flowverse</a></div></div><div class="div-block-129"><div class="footer-copyright">© 2023 All Rights Reserved</div></div></div></div><script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=5f734f4dbd95382f4fdfa0ea" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script><script src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/js/webflow.2724f1538.js" type="text/javascript"></script><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NHJB3BPPXG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NHJB3BPPXG');
</script>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PWSGFLB"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --><script src="../../cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="../../cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/unescaped-markup/prism-unescaped-markup.min.js"></script></body>
<!-- Mirrored from flow.com/engineering-blogs/verify-usdc-balance-and-nft-meta-data-with-proof by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 22 Jul 2023 16:23:07 GMT -->
</html>