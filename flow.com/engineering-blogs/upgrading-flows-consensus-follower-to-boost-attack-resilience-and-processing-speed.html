<!DOCTYPE html><!-- This site was created in Webflow. https://www.webflow.com --><!-- Last Published: Mon Jul 17 2023 22:17:53 GMT+0000 (Coordinated Universal Time) --><html data-wf-domain="flow-com.webflow.io" data-wf-page="637380c394c328ab5ad74bb3" data-wf-site="5f734f4dbd95382f4fdfa0ea" lang="en">
<!-- Mirrored from flow.com/engineering-blogs/upgrading-flows-consensus-follower-to-boost-attack-resilience-and-processing-speed by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 22 Jul 2023 16:22:10 GMT -->
<head><meta charset="utf-8"/><title>Upgrading Flow&#x27;s Consensus Follower to boost attack resilience and processing speed</title><meta content="May 30, 2023" name="description"/><meta content="Upgrading Flow&#x27;s Consensus Follower to boost attack resilience and processing speed" property="og:title"/><meta content="May 30, 2023" property="og:description"/><meta content="https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/64764d658a28954c019d3957_Blog%20Image%20-%20Upgrading%20Flow%E2%80%99s%20Consensus%20Follower%20v3.png" property="og:image"/><meta content="Upgrading Flow&#x27;s Consensus Follower to boost attack resilience and processing speed" property="twitter:title"/><meta content="May 30, 2023" property="twitter:description"/><meta content="https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/64764d658a28954c019d3957_Blog%20Image%20-%20Upgrading%20Flow%E2%80%99s%20Consensus%20Follower%20v3.png" property="twitter:image"/><meta property="og:type" content="website"/><meta content="summary_large_image" name="twitter:card"/><meta content="width=device-width, initial-scale=1" name="viewport"/><meta content="goOrjM0FiQtmK2lUJ9Y5NpPJA-fMUUc_6Q6Vmd7-XIY" name="google-site-verification"/><meta content="Webflow" name="generator"/><link href="../../assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/css/flow-com.webflow.9325b97a3.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/" rel="preconnect"/><link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin="anonymous"/><script src="../../ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script><script type="text/javascript">WebFont.load({  google: {    families: ["Epilogue:300,regular,500,600,700,800,900,italic"]  }});</script><script src="../../use.typekit.net/mgu2ukv.js" type="text/javascript"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script><script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script><link href="../../assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/616b1520779838b5f9174363_favicon.png" rel="shortcut icon" type="image/x-icon"/><link href="../../assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/616b1548fd01d005fc2bc2c7_logo256.png" rel="apple-touch-icon"/><link href="upgrading-flows-consensus-follower-to-boost-attack-resilience-and-processing-speed.html" rel="canonical"/><style>
  .w-webflow-badge {
    display: none !important;
  }
</style>


<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'../../www.googletagmanager.com/gtm5445.html?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PWSGFLB');</script>
<!-- End Google Tag Manager -->


<meta name="facebook-domain-verification" content="dhlb5fcuitl7owilmsg6xh307ohoyc" />

<!-- Hotjar Tracking Code for Flow.com -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:3329982,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
<link rel="stylesheet" href="../../cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" /></head><body><div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="navigation w-nav"><div class="nav-container w-container"><a href="../index.html" class="nav-logo-div w-nav-brand"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63ce603ae36f46f6bb67e51e_flow-logo.svg" loading="lazy" alt="flow logo" class="hide"/><div aria-label="Flow logo" class="nav-logo__embed w-embed"><svg width="100" height="42" viewBox="0 0 100 42" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_106_24812)">
<path class="logotype" d="M57.3672 20.9501H54.6797V30.971H50.9297V20.9501H48.9922V17.7376H50.9297V16.4876C50.9297 13.2501 52.9505 11.5876 56.0214 11.5876C56.4968 11.5916 56.9705 11.6475 57.4339 11.7543V15.5043C57.0296 15.3422 56.5985 15.2574 56.163 15.2543C55.9663 15.2387 55.7684 15.2659 55.5832 15.334C55.3979 15.4021 55.2296 15.5096 55.0899 15.6489C54.9501 15.7883 54.8422 15.9563 54.7735 16.1414C54.7049 16.3264 54.6771 16.5242 54.6922 16.721V17.7168H57.3797L57.3672 20.9501ZM63.013 30.971H59.2214V11.871H63.013V30.971Z" fill="black"/>
<path class="logotype" d="M71.4292 16.9085C72.851 16.906 74.2415 17.3255 75.4247 18.1139C76.6079 18.9023 77.5306 20.024 78.0758 21.3371C78.6211 22.6502 78.7644 24.0956 78.4876 25.4902C78.2108 26.8848 77.5264 28.1658 76.5211 29.1712C75.5157 30.1766 74.2346 30.861 72.84 31.1377C71.4454 31.4145 70.0001 31.2712 68.687 30.726C67.3739 30.1807 66.2521 29.2581 65.4638 28.0749C64.6754 26.8917 64.2559 25.5011 64.2584 24.0793C64.2466 23.1344 64.4241 22.1967 64.7803 21.3213C65.1365 20.446 65.6642 19.6508 66.3325 18.9826C67.0007 18.3144 67.7959 17.7866 68.6712 17.4304C69.5465 17.0742 70.4842 16.8968 71.4292 16.9085V16.9085ZM71.4292 27.596C73.3667 27.596 74.7625 25.9877 74.7625 24.0793C74.7834 23.6288 74.7126 23.1787 74.5544 22.7563C74.3963 22.3339 74.1541 21.9481 73.8424 21.622C73.5308 21.296 73.1562 21.0366 72.7414 20.8595C72.3266 20.6824 71.8802 20.5914 71.4292 20.5918C70.5213 20.6232 69.661 21.0058 69.0298 21.6592C68.3986 22.3125 68.0458 23.1855 68.0458 24.0939C68.0458 25.0024 68.3986 25.8753 69.0298 26.5286C69.661 27.182 70.5213 27.5647 71.4292 27.596Z" fill="black"/>
<path class="logotype" d="M82.5576 17.1875L84.9951 26.3542L87.4326 19.0708L86.7659 17.1917H90.5159L93.7284 26.3583L96.1076 17.1917H99.9992L95.9034 30.975H91.9701L89.2284 23.4167L86.6659 30.9708H82.7076L78.6367 17.1875H82.5576Z" fill="black"/>
<path d="M20.8333 41.8334C32.3393 41.8334 41.6667 32.506 41.6667 21.0001C41.6667 9.49415 32.3393 0.166748 20.8333 0.166748C9.3274 0.166748 0 9.49415 0 21.0001C0 32.506 9.3274 41.8334 20.8333 41.8334Z" fill="#00EF8B"/>
<path d="M29.9732 17.7417H24.0898V23.625H29.9732V17.7417Z" fill="white"/>
<path d="M18.2138 25.8292C18.2138 26.266 18.0843 26.6929 17.8416 27.0561C17.599 27.4192 17.2541 27.7023 16.8506 27.8694C16.447 28.0366 16.003 28.0803 15.5746 27.9951C15.1463 27.9099 14.7528 27.6996 14.4439 27.3907C14.1351 27.0819 13.9248 26.6884 13.8396 26.26C13.7544 25.8316 13.7981 25.3876 13.9652 24.9841C14.1324 24.5806 14.4154 24.2357 14.7786 23.993C15.1417 23.7504 15.5687 23.6209 16.0055 23.6209H18.2138V17.7417H16.0055C14.4059 17.7417 12.8423 18.216 11.5123 19.1047C10.1823 19.9934 9.14572 21.2564 8.5336 22.7342C7.92147 24.212 7.76131 25.8382 8.07337 27.407C8.38543 28.9758 9.15569 30.4169 10.2867 31.5479C11.4178 32.679 12.8589 33.4492 14.4277 33.7613C15.9965 34.0733 17.6226 33.9132 19.1004 33.3011C20.5782 32.6889 21.8413 31.6523 22.73 30.3224C23.6186 28.9924 24.093 27.4287 24.093 25.8292V23.6209H18.2138V25.8292Z" fill="white"/>
<path d="M26.2984 14.8001H32.9151V8.91675H26.2984C24.1542 8.91895 22.0984 9.77174 20.5821 11.288C19.0659 12.8042 18.2131 14.86 18.2109 17.0042V17.7417H24.0901V17.0042C24.0912 16.4193 24.3244 15.8587 24.7384 15.4454C25.1524 15.0322 25.7135 14.8001 26.2984 14.8001V14.8001Z" fill="white"/>
<path d="M18.2109 23.6209H24.0901V17.7417H18.2109V23.6209Z" fill="#00EF8B"/>
</g>
<defs>
<clipPath id="clip0_106_24812">
<rect width="100" height="41.6666" fill="white" transform="translate(0 0.166748)"/>
</clipPath>
</defs>
</svg></div></a><nav role="navigation" class="new-navigation-menu w-nav-menu"><div data-hover="false" data-delay="0" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">Solutions</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list w-dropdown-list"><a href="../hybrid-custody.html" class="navigation-dropdown-link w-dropdown-link">Walletless Onboarding +Hybrid Custody</a><a href="http://developers.flow.com/hybrid-custody/guides/account-abstraction" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Account Abstraction</a><a href="https://developers.flow.com/cadence" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Cadence</a></nav></div><div data-hover="false" data-delay="0" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">Developers</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list w-dropdown-list"><a href="https://developers.flow.com/" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Developer portal</a><a href="https://github.com/onflow" class="navigation-dropdown-link w-dropdown-link">GitHub</a></nav></div><div data-hover="false" data-delay="0" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">Ecosystem</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list ecosystem w-dropdown-list"><a href="https://www.flowverse.co/" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Flowverse</a></nav></div><div data-hover="false" data-delay="0" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">Community</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list community w-dropdown-list"><a href="../flow-ambassador-program.html" class="navigation-dropdown-link w-dropdown-link">Ambassador program</a><a href="../blog.html" class="navigation-dropdown-link w-dropdown-link">Blog</a><a href="https://forum.onflow.org/" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Forum</a><a href="https://discord.com/invite/J6fFnh2xx6" target="_blank" class="navigation-dropdown-link discord w-dropdown-link">Discord</a><a href="https://twitter.com/flow_blockchain" class="navigation-dropdown-link twitter w-dropdown-link">Twitter</a></nav></div><div data-hover="false" data-delay="100" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">About</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list ecosystem w-dropdown-list"><a href="../primer.html" class="navigation-dropdown-link w-dropdown-link">Primer</a><a href="../priorities.html" class="navigation-dropdown-link w-dropdown-link">Priorities</a><a href="../use-cases.html" class="navigation-dropdown-link w-dropdown-link">Use Cases</a><a href="../flow-token-economics.html" class="navigation-dropdown-link w-dropdown-link">Token economics</a><a href="../technical-paper.html" class="navigation-dropdown-link w-dropdown-link">Technical papers</a><a href="../sustainability.html" class="navigation-dropdown-link w-dropdown-link">Sustainability</a></nav></div></nav><div class="new-menu-button w-nav-button"><div class="w-icon-nav-menu"></div></div></div></div><div><div class="post-with-image-layout"><div class="blog-post-hero-2 wf-section"><div class="post-container w-container"><div><div class="blog-post-meta-data in-post"><div class="w-dyn-list"><div role="list" class="eng-blog-category-list w-dyn-items"><div role="listitem" class="w-dyn-item"><a href="../engineering-categories/blockchain.html" class="radius-text w-inline-block"><div class="eco-text-2">Blockchain</div></a></div></div></div><div class="small-dot-sep inpost left"></div><div class="blog-post-meta-text-data">May 30, 2023</div></div><div class="main-blog-post-title">Upgrading Flow&#x27;s Consensus Follower to boost attack resilience and processing speed</div><div class="blog-post-meta-data post"><a href="../authors/jordan-schalm.html" class="blog-post-meta-text-data dark">Jordan Schalm</a><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">Senior Software Engineer</div></div></div></div></div><div class="blog-post-section wf-section"><div class="container-25 _1280 w-container"><div class="post-info-parent"><div class="post-share-sidebar"><div class="social-share-btn-2 tw"></div><div class="social-share-btn-2 email"></div><div class="share-text">Share</div></div><div class="post-main-info-div eng"><img loading="lazy" src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/64764d658a28954c019d3957_Blog%20Image%20-%20Upgrading%20Flow%e2%80%99s%20Consensus%20Follower%20v3.png" alt="Upgrading Flow&#x27;s Consensus Follower to boost attack resilience and processing speed" sizes="(max-width: 479px) 83vw, (max-width: 767px) 92vw, (max-width: 991px) 81vw, 750px" srcset="https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/64764d658a28954c019d3957_Blog%20Image%20-%20Upgrading%20Flow%E2%80%99s%20Consensus%20Follower%20v3-p-500.png 500w, https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/64764d658a28954c019d3957_Blog%20Image%20-%20Upgrading%20Flow%E2%80%99s%20Consensus%20Follower%20v3-p-800.png 800w, https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/64764d658a28954c019d3957_Blog%20Image%20-%20Upgrading%20Flow%E2%80%99s%20Consensus%20Follower%20v3-p-1080.png 1080w, https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/64764d658a28954c019d3957_Blog%20Image%20-%20Upgrading%20Flow%E2%80%99s%20Consensus%20Follower%20v3.png 1600w" class="blog-post-main-image"/><div class="blog-post-rich-text-block w-richtext"><p>Earlier this year, Flow’s consensus team rolled out a <a href="jolteon-advancing-flows-consensus-algorithm.html">major upgrade to our consensus algorithm</a>. The upgrade reduced transaction finalization time by 30 percent and enabled faster, automatic recovery from network partitions, attacks and upgrades. </p><p>As part of this upgrade, the research team laid the technical foundation for an array of improvements to the Follower mode of the consensus algorithm, improving attack resilience and processing speed for all non-consensus nodes, including observer nodes, which anyone can operate without staking. We&#x27;re excited to share that these improvements will be rolling out in the June 2023 network upgrade. In this article, we explain our improvements in more detail and their implications for the Flow network.</p><h2><strong>Participants and Followers in Flow&#x27;s Consensus</strong></h2><p>Flow processes transactions in a pipelined manner, where five specialized node types — access, collection, consensus, execution, and verification nodes (all staked) — work together. In addition, there are non-staked observer nodes. In a nutshell, consensus nodes schedule transactions for execution by proposing new blocks and voting on them. The other nodes track the chain as it advances and perform the work as orchestrated by the consensus nodes.</p><p>Flow&#x27;s consensus protocol supports two modes: <strong>Participant</strong> and <strong>Follower</strong>. A Participant is a node that actively contributes to advancing consensus via proposing and voting on new blocks. A central responsibility of Participants is to enforce block validity, by only voting on valid blocks and raising slashing challenges on invalid blocks. Consensus nodes operate in the Participant mode for Flow&#x27;s main consensus [1].</p><p>The <strong>Consensus Follower</strong> is the module which allows any non-consensus node to track consensus progress trustlessly. The follower independently applies consensus rules and locally asserts block finality. Essentially, it shields the higher-level processing logic within the node from any malicious nodes sending invalid blocks. Unlike Participants, Followers do not need to validate block payloads in full — instead they can validate block headers only, utilizing the verification work already done by Participants.</p><h2><strong>Improvements</strong></h2><p>The new Follower implementation leverages the architectural improvements of our recent consensus upgrade by hardening nodes against various attacks, enabling the Follower to detect consensus violations, and lays the groundwork for extremely efficient light clients in the future.</p><p>The majority of improvements were unlocked by redesigning how and when Flow nodes validate Quorum Certificates (QCs). A QC is an aggregate of votes from a supermajority of consensus participants. While proposing or voting for an invalid block is a slashable protocol violation, the protocol still has to handle this scenario as individual consensus participants can be purposefully malicious (in technical terms ‘Byzantine’).</p><p>Flow employs Jolteon as its BFT consensus algorithm, which is an optimized flavor of HotStuff. In HotStuff, the QC for block B is included in B’s child block(s). A valid QC attests that a supermajority of consensus participants consider the block a valid extension of the chain. We say that a block B is certified, if and only if a valid QC for block B is known.</p><figure class="w-richtext-figure-type-image w-richtext-align-center" class="w-richtext-align-center w-richtext-figure-type-image"><div><img src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/6476363ec94d4fa3043e4844_42c2e2fa.png" alt=""/></div></figure><p>The Follower upgrade focuses on performance and resilience to Byzantine attacks. To mitigate attacks via invalid blocks, we re-designed the Follower’s internal processing of incoming blocks to:</p><ul role="list"><li>Validate block headers before they are cached</li><li>Cache certified blocks separately from uncertified blocks</li><li>Never store blocks which are invalid</li></ul><h3><strong>Validate or Discard</strong></h3><p>In the previous version of the Follower, it was necessary to know a block&#x27;s entire ancestry before we could validate the block’s header. For performance reasons, it is important to temporarily cache blocks, even if some ancestors are still missing.</p><p>The necessity to cache disconnected blocks could have been exploited as a vector for memory exhaustion attacks on the previous follower implementation:</p><figure class="w-richtext-figure-type-image w-richtext-align-center" class="w-richtext-align-center w-richtext-figure-type-image"><div><img src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/6476363fa5142687bfc4ee9e_33b9e723.png" alt=""/></div></figure><p>In the depicted example, Evil Edward — a Byzantine consensus participant — is making up a long fork of blocks. As these blocks are fake, they haven’t been voted on by the consensus committee and no valid QCs exist for them. Therefore, Edward includes invalid QCs in his fork. The previous Follower cannot assess whether the QCs in Edward’s fork are valid since the Follower does not know the full ancestry for the fork.</p><p>With enough blocks and time, this attack could cause the Follower to crash with an out of memory exception. Even without a crash, this memory exhaustion attack can harm the Follower by flooding its cache with fake blocks, which delay the processing of valid blocks. In tests, we have seen that mounting a memory exhaustion attack on a node’s Follower caused the node to fall behind and fail to fulfill its function within the network in a timely manner.</p><p>The upgraded Follower can now validate blocks within the current epoch (one week) before their ancestors are known. Therefore, the new consensus follower would detect Edward’s fake blocks as invalid, discard them and raise a slashing challenge against Edward. Blocks outside the current epoch are immediately discarded.</p><h3><strong>Cache / Storage Improvements</strong></h3><p>The Follower uses a cache to store blocks which have not yet been incorporated into the blockchain. This cache is now separated into distinct sections for certified and uncertified blocks.</p><figure class="w-richtext-figure-type-image w-richtext-align-center" class="w-richtext-align-center w-richtext-figure-type-image"><div><img src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/6476363fa5142687bfc4ee8b_e84a6d9e.png" alt=""/></div></figure><p>In the example above, the malicious primary has created 1,001 conflicting blocks. Consensus rules guarantee that only one of them will get certified (in our example block B). However, it is not clear in advance which one will eventually be certified to a Follower receiving the blocks. Therefore, the old Follower would store <em>all</em> blocks on disk, which is a vector for storage exhaustion attacks.</p><p>In comparison, the new Follower only stores <em>certified</em> blocks on disk. As only one of the many conflicting blocks can be certified, certified blocks pose little risk of storage exhaustion attacks.</p><p>Uncertified blocks have a valid proposer signature, but may nevertheless pose a threat in the case of a malicious leader. Therefore these blocks are stored <em>separately</em> in a size-limited cache which mitigates memory exhaustion attacks.</p><h3><strong>Parallel Validation</strong></h3><p>Flow&#x27;s core consensus algorithm runs in a single-threaded event loop, meaning that one event is processed at a time. This is desirable for the simplicity of this mission-critical component, but limits performance.</p><p>A focus of recent architectural changes to Flow&#x27;s consensus has been shifting work out of this event loop where possible. The team implemented parallel vote processing in early 2022, parallel timeout processing in the recent Jolteon upgrade, and we are extending this to include parallel QC validation in the Follower engine as part of Follower V2.</p><p>This change is particularly beneficial when a node which has fallen behind is catching up, because it can process more blocks in parallel.</p><h3><strong>Chained Validation</strong></h3><p>When a block is certified, a supermajority of Consensus Nodes have agreed that the block is a valid extension of the state and voted for it. As a blockchain where each block builds upon its parent, a block is only valid if it is extending a valid block. In other words, if a block is certified, then all its ancestors are certified, too.</p><figure class="w-richtext-figure-type-image w-richtext-align-center" class="w-richtext-align-center w-richtext-figure-type-image"><div><img src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/6476363f90161b0dfa1d1ed0_0288c4fc.png" alt=""/></div></figure><p>The new Follower can leverage this fact to avoid unnecessary work. When processing a sequential range of blocks, it is sufficient to ensure that the block at the end of the range is certified (and to check that the block hashes match). Hence, we only perform one expensive signature validation operation for the entire batch, instead of one for every block in the batch.</p><p>When a node is catching up, it receives blocks in sequential ranges by default, and can make use of this validation improvement to improve syncing speed.</p><h2><strong>Laying the foundation for smartphone-sized light clients</strong></h2><p>When envisioning light clients running on embedded hardware, including smartphones, there are three main challenges to solve:</p><ol role="list"><li><strong>The amount of CPU cycles, memory, and storage that a light client can reasonably consume is extremely limited.</strong> You probably prefer to use your smartphone storage for photos rather than gigabytes of chain data.</li><li><strong>For a light client to be useful to an average end user, it has to deal with being offline for prolonged periods of time.</strong> Even if the light client were allowed to validate chain progress constantly by the operating system and user behavior, doing so would deplete batteries unacceptably quickly.</li><li><strong>Lastly, the light client must be able to catch up on multiple days of chain progress quickly and efficiently.</strong> Downloading all blocks is not an option. Imagine returning from a three-day camping trip, eagerly trying to check whether the trades for some NBA Top Shot Moments have succeeded – but your phone takes 20 minutes to download and validate all the block headers it missed… and runs out of battery.</li></ol><p>As discussed earlier in this article, the new Follower allows validating QCs for blocks without knowing their entire ancestry as long as those blocks are within a known epoch. For Flow, an epoch is typically one week long. Within this week, the set of authorized nodes remains unchanged. If a node is slashed, the network might revoke their right to propose blocks, but no new nodes are added mid epoch.</p><p>At the epoch transition, the nodes authorized to run Epoch N hand the control of the blockchain over to the nodes for Epoch N+1. Slightly simplified, this works as follows:</p><figure class="w-richtext-figure-type-image w-richtext-align-center" class="w-richtext-align-center w-richtext-figure-type-image"><div><img src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/6476363fa5142687bfc4ee63_b7c6e4c2.png" alt=""/></div></figure><ol role="list"><li>At the beginning of Epoch N, new nodes can participate in the staking auction for Epoch N+1.</li><li>At the end of the staking auction phase, an EpochSetup event is included in a block, which lists all authorized nodes for Epoch N+1. Thereafter, the nodes for Epoch N+1 collaboratively execute a distributed key generation (DKG) protocol during the Epoch Setup Phase. This important step allows Flow to be of very few blockchains to provide secure randomness natively within the protocol. The EpochCommit event is included in a block when the DKG ends.</li><li>The EpochSetup and EpochCommit events together form the ‘Identity Table’ for Epoch N+1. In a nutshell, the Identity Table for Epoch X contains all information necessary (such as node identities, roles, public keys, etc) for validating QCs generated during Epoch X.</li></ol><p>Note that any Follower that has the Identity table for Epoch N only needs a few blocks to construct the Identity Table for Epoch N+1. The figure below illustrates this process:</p><figure class="w-richtext-figure-type-image w-richtext-align-center" class="w-richtext-align-center w-richtext-figure-type-image"><div><img src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/6476363f30799ace2c036618_00fa76bb.png" alt=""/></div></figure><ul role="list"><li>The Follower simply contacts a full node and requests “the blocks containing the EpochSetup and EpochCommit events for Epoch N+1 plus sufficiently many child blocks proving that the EpochSetup and EpochCommit events were sealed.”</li><li>The Follower, which knows the Identity Table for Epoch N, can assess the integrity of the response by checking the QCs and block hashes, because all the blocks it received must belong to Epoch N. If any check fails, the Follower knows it has received a corrupted response and discards it. However, if the checks pass, the Follower has cryptographic proof that the consensus committee of Epoch N committed the EpochSetup and EpochCommit events.</li><li>At this point, the Follower knows the correct Identity Table for Epoch N+1 and can repeat the same process to retrieve the Identity Table for Epoch N+2 and subsequently N+3, etc.</li></ul><p>In summary, the Consensus Follower only needs to retrieve two chain segments of 10-20 blocks each to locally construct the identity table for the following epoch. The validity of the blocks is asserted through validating the tailing QC at the end of each batch and re-hashing the received blocks.</p><p>While roughly 460,000 blocks are finalized during an epoch, a consensus Follower only needs to retrieve 0.005 percent of those blocks. Thereby, the Follower can fast-forward through months or even years of blocks consuming negligible computational and networking resources.</p><p>Furthermore, consider an Epoch (past or current) for which the Follower knows the identity table. The Follower can retrieve a short chain segment at any height belonging to the epoch and assert its validity and finality by checking the QCs. Hence, the Follower can trustlessly obtain the state root hash for nearly any block of the epoch, as state root hashes are also contained in the blocks [2]. When knowing the state root hash at some block, it becomes possible to selectively retrieve part of the state in a trustless manner utilizing Merkle proofs.</p><h3><strong>Notes</strong></h3><ul role="list"><li>[1] Collection nodes are a special case, because they operate as both Participants and Followers. They follow Flow&#x27;s main consensus while participating in their cluster&#x27;s sub-consensus protocol, which ingests a portion of transactions inbound to Flow. This separation of responsibilities is one of the innovations supporting Flow&#x27;s scalable architecture.</li><li>[2] We simplified the discussion here a little. In Flow, blocks don’t directly contain the state root hash obtained after executing the contained transactions. Instead, block execution is asynchronous in Flow, and execution results are embedded into descending blocks once they become available. If you want to learn more, we recommend<a href="https://jan-bernatik.medium.com/introduction-to-flow-blockchain-part-4-f818b85a328f"> this excellent blog series</a>.</li></ul><p>‍<strong>Interested in building on Flow? </strong><a href="https://developers.flow.com/">Visit our developer portal</a> to get started, and keep in touch with us on <a href="https://twitter.com/flow_blockchain">Twitter</a> or <a href="https://discord.com/invite/J6fFnh2xx6">Discord</a>.</p></div><div class="tags-post-div"><div class="tags-title-14">Tags:</div><div class="w-dyn-list"><div class="w-dyn-empty"><div>No items found.</div></div></div></div></div></div></div></div></div><div class="post-with-text-layout hide"><div class="blog-post-hero-2 no-image wf-section"><div class="post-container w-container"><div><div class="blog-post-meta-data in-post"><div class="blog-post-category">Studio</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">03/30/2021</div></div><div class="main-blog-post-title">Welcoming Animoca, MotoGP, and StarGirl to Flow</div><div class="blog-post-meta-data post"><div class="blog-post-meta-text-data dark">Mik Naayem</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">CBO and Cofounder at Dapper Labs</div></div></div></div></div><div class="blog-post-section wf-section"><div class="container-25 _1280 w-container"><div class="post-info-parent no-img"><div class="post-share-sidebar"><div class="social-share-btn-2 tw"></div><div class="social-share-btn-2 email"></div><div class="share-text">Share</div></div><div class="post-main-info-div"><div class="blog-post-rich-text w-richtext"><p>The rich text element allows you to create and format headings, paragraphs, blockquotes, images, and video all in one place instead of having to add and format them individually. Just double-click and easily create content.</p><ul role="list"><li>Decentralized because you can set up a blockchain system so that every entity can only make changes within its predefined purview. Companies can also use permissionless, permissioned, or hybrid-approach blockchains, allowing for useful trade-offs between network security and system privacy.</li><li>Decentralized because you can set up a blockchain system so that every entity can only make changes within its predefined purview. Companies can also use permissionless, permissioned, or hybrid-approach blockchains, allowing for useful trade-offs between network security and system privacy.</li><li>scscsssc</li></ul><h4>Static and dynamic content editing</h4><blockquote>A rich text element can be used with static or dynamic content. For static content, just drop it into any page and begin editing. For dynamic content, add a<a href="http://www.google.com/"> rich text field to any collection</a> and then connect a rich text element to that field in the settings panel. Voila!</blockquote><h4>How to customize formatting for each rich text</h4><p>Headings, paragraphs, blockquotes, figures, images, and figure captions can all be styled after a class is added to the rich text element using the &quot;When inside of&quot; nested selector system.</p></div></div></div></div></div></div><div class="section-32 wf-section"><div class="container-25 _1280 w-container"><div class="title-div-3"><div>Related Content</div></div><div class="w-dyn-list"><div role="list" class="w-dyn-items"><div role="listitem" class="w-dyn-item"><div class="blog-post-parant-div first"><div class="blog-post-info-div"><a href="jolteon-advancing-flows-consensus-algorithm.html" class="blog-post-title">Jolteon: Advancing Flow’s consensus algorithm</a><div class="blog-post-meta-data"><div class="blog-post-meta-text-data">Apr 14, 2023</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">Jordan Schalm</div></div></div></div></div><div role="listitem" class="w-dyn-item"><div class="blog-post-parant-div first"><div class="blog-post-info-div"><a href="golang-services-improving-observability.html" class="blog-post-title">Improving Observability of GoLang Services</a><div class="blog-post-meta-data"><div class="blog-post-meta-text-data">Jan 31, 2023</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">Alexey Ivanov</div></div></div></div></div><div role="listitem" class="w-dyn-item"><div class="blog-post-parant-div first"><div class="blog-post-info-div"><a href="flow-blockchain-programming-language-smart-contract-cadence-solidity-comparison-ethereum.html" class="blog-post-title">Cadence or Solidity: On-Chain Token Transfer Deep Dive</a><div class="blog-post-meta-data"><div class="blog-post-meta-text-data">Jan 24, 2023</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">Jerome Pimmel</div></div></div></div></div></div></div></div></div></div><div class="section footer wf-section"><div class="footer-div"><div class="join-text-2 no-hover">Join Flow on</div><a href="https://twitter.com/flow_blockchain" target="_blank" class="join-text-2">Twitter</a><a href="https://discord.com/invite/J6fFnh2xx6" target="_blank" class="join-text-2">Discord</a><a href="../index.html" target="_blank" class="join-text-2">flow.com</a></div></div><div class="new-footer wf-section"><div class="container w-container"><div class="w-layout-grid _3-footer-grid"><div><a id="w-node-ec243fb8-8059-5bdb-528d-ce0b082ca18b-082ca187" href="../index.html" class="footer-logo-link w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63ce603ae36f46f6bb67e51e_flow-logo.svg" loading="lazy" alt="flow logo" class="footer-logo-img"/></a><div class="footer-social-icons"><a href="https://twitter.com/flow_blockchain" target="_blank" class="footer-social-icon w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63cec770abbeba426e358f76_Twitter - Negative.svg" loading="lazy" alt="social icon"/></a><a href="https://www.instagram.com/flowblockchain" target="_blank" class="footer-social-icon w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63cec770799e2958d15306a0_Instagram - Negative.svg" loading="lazy" alt="social icon"/></a><a href="https://www.youtube.com/@FlowBlockchain" target="_blank" class="footer-social-icon w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63cec77005a49eaba248e147_YouTube - Negative.svg" loading="lazy" alt="social icon"/></a><a href="https://t.me/flow_blockchain" target="_blank" class="footer-social-icon w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63cec770b75d5482a08014db_Telegram - Negative.svg" loading="lazy" alt="social icon"/></a><a href="https://discord.com/invite/J6fFnh2xx6" target="_blank" class="footer-social-icon last w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63d0398494fe5d96e72f4cc0_Social Icon.svg" loading="lazy" alt="social icon"/></a></div></div><div id="w-node-_843ebe60-d3a2-032c-780e-737a5989cba0-082ca187"><div class="footer-column-header">Start Building</div><a href="https://developers.flow.com/" target="_blank" class="new-footer-link">Developer portal</a><a href="https://github.com/onflow" target="_blank" class="new-footer-link">GitHub</a></div><div id="w-node-ec243fb8-8059-5bdb-528d-ce0b082ca19f-082ca187"><div class="footer-column-header">Flow</div><a href="https://docs.google.com/forms/d/e/1FAIpQLSer5ZX0pRWsXF0U0bsgW4Zo8Pmlw0V927ZydDq_ej-qyIJ9_A/viewform" target="_blank" class="new-footer-link">Business Development</a><a href="../node-operation.html" target="_blank" class="new-footer-link">Node Operation</a><a href="../token-distribution.html" class="new-footer-link">Token Distribution</a><a href="../mediakit.html" class="new-footer-link">Media Kit</a><a href="../careers.html" class="new-footer-link">Careers</a><a href="../faq.html" class="new-footer-link">FAQ</a></div><div id="w-node-ec243fb8-8059-5bdb-528d-ce0b082ca198-082ca187"><div class="footer-column-header">Get Connected</div><a href="https://port.onflow.org/" target="_blank" class="new-footer-link">Flow Port</a><a href="https://www.flowverse.co/" target="_blank" class="new-footer-link">Flowverse</a></div></div><div class="div-block-129"><div class="footer-copyright">© 2023 All Rights Reserved</div></div></div></div><script src="../../d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c89892.js?site=5f734f4dbd95382f4fdfa0ea" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script><script src="../../assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/js/webflow.2724f1538.js" type="text/javascript"></script><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NHJB3BPPXG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NHJB3BPPXG');
</script>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PWSGFLB"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --><script src="../../cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="../../cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/unescaped-markup/prism-unescaped-markup.min.js"></script></body>
<!-- Mirrored from flow.com/engineering-blogs/upgrading-flows-consensus-follower-to-boost-attack-resilience-and-processing-speed by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 22 Jul 2023 16:22:18 GMT -->
</html>