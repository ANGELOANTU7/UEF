<!DOCTYPE html><!-- This site was created in Webflow. https://www.webflow.com --><!-- Last Published: Mon Jul 17 2023 22:17:53 GMT+0000 (Coordinated Universal Time) --><html data-wf-domain="flow-com.webflow.io" data-wf-page="637380c394c328ab5ad74bb3" data-wf-site="5f734f4dbd95382f4fdfa0ea" lang="en">
<!-- Mirrored from flow.com/engineering-blogs/jolteon-advancing-flows-consensus-algorithm by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 22 Jul 2023 16:22:19 GMT -->
<head><meta charset="utf-8"/><title>Jolteon: Advancing Flow’s consensus algorithm</title><meta content="Apr 14, 2023" name="description"/><meta content="Jolteon: Advancing Flow’s consensus algorithm" property="og:title"/><meta content="Apr 14, 2023" property="og:description"/><meta content="https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/64397a4888791d71996cf86c_Blog%20Image%20-%20Jolteon_%20Advancing%20Flow%E2%80%99s%20Consensus%20Algorithm.png" property="og:image"/><meta content="Jolteon: Advancing Flow’s consensus algorithm" property="twitter:title"/><meta content="Apr 14, 2023" property="twitter:description"/><meta content="https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/64397a4888791d71996cf86c_Blog%20Image%20-%20Jolteon_%20Advancing%20Flow%E2%80%99s%20Consensus%20Algorithm.png" property="twitter:image"/><meta property="og:type" content="website"/><meta content="summary_large_image" name="twitter:card"/><meta content="width=device-width, initial-scale=1" name="viewport"/><meta content="goOrjM0FiQtmK2lUJ9Y5NpPJA-fMUUc_6Q6Vmd7-XIY" name="google-site-verification"/><meta content="Webflow" name="generator"/><link href="../../assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/css/flow-com.webflow.9325b97a3.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/" rel="preconnect"/><link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin="anonymous"/><script src="../../ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script><script type="text/javascript">WebFont.load({  google: {    families: ["Epilogue:300,regular,500,600,700,800,900,italic"]  }});</script><script src="../../use.typekit.net/mgu2ukv.js" type="text/javascript"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script><script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script><link href="../../assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/616b1520779838b5f9174363_favicon.png" rel="shortcut icon" type="image/x-icon"/><link href="../../assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/616b1548fd01d005fc2bc2c7_logo256.png" rel="apple-touch-icon"/><link href="jolteon-advancing-flows-consensus-algorithm.html" rel="canonical"/><style>
  .w-webflow-badge {
    display: none !important;
  }
</style>


<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'../../www.googletagmanager.com/gtm5445.html?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PWSGFLB');</script>
<!-- End Google Tag Manager -->


<meta name="facebook-domain-verification" content="dhlb5fcuitl7owilmsg6xh307ohoyc" />

<!-- Hotjar Tracking Code for Flow.com -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:3329982,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
<link rel="stylesheet" href="../../cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" /></head><body><div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="navigation w-nav"><div class="nav-container w-container"><a href="../index.html" class="nav-logo-div w-nav-brand"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63ce603ae36f46f6bb67e51e_flow-logo.svg" loading="lazy" alt="flow logo" class="hide"/><div aria-label="Flow logo" class="nav-logo__embed w-embed"><svg width="100" height="42" viewBox="0 0 100 42" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_106_24812)">
<path class="logotype" d="M57.3672 20.9501H54.6797V30.971H50.9297V20.9501H48.9922V17.7376H50.9297V16.4876C50.9297 13.2501 52.9505 11.5876 56.0214 11.5876C56.4968 11.5916 56.9705 11.6475 57.4339 11.7543V15.5043C57.0296 15.3422 56.5985 15.2574 56.163 15.2543C55.9663 15.2387 55.7684 15.2659 55.5832 15.334C55.3979 15.4021 55.2296 15.5096 55.0899 15.6489C54.9501 15.7883 54.8422 15.9563 54.7735 16.1414C54.7049 16.3264 54.6771 16.5242 54.6922 16.721V17.7168H57.3797L57.3672 20.9501ZM63.013 30.971H59.2214V11.871H63.013V30.971Z" fill="black"/>
<path class="logotype" d="M71.4292 16.9085C72.851 16.906 74.2415 17.3255 75.4247 18.1139C76.6079 18.9023 77.5306 20.024 78.0758 21.3371C78.6211 22.6502 78.7644 24.0956 78.4876 25.4902C78.2108 26.8848 77.5264 28.1658 76.5211 29.1712C75.5157 30.1766 74.2346 30.861 72.84 31.1377C71.4454 31.4145 70.0001 31.2712 68.687 30.726C67.3739 30.1807 66.2521 29.2581 65.4638 28.0749C64.6754 26.8917 64.2559 25.5011 64.2584 24.0793C64.2466 23.1344 64.4241 22.1967 64.7803 21.3213C65.1365 20.446 65.6642 19.6508 66.3325 18.9826C67.0007 18.3144 67.7959 17.7866 68.6712 17.4304C69.5465 17.0742 70.4842 16.8968 71.4292 16.9085V16.9085ZM71.4292 27.596C73.3667 27.596 74.7625 25.9877 74.7625 24.0793C74.7834 23.6288 74.7126 23.1787 74.5544 22.7563C74.3963 22.3339 74.1541 21.9481 73.8424 21.622C73.5308 21.296 73.1562 21.0366 72.7414 20.8595C72.3266 20.6824 71.8802 20.5914 71.4292 20.5918C70.5213 20.6232 69.661 21.0058 69.0298 21.6592C68.3986 22.3125 68.0458 23.1855 68.0458 24.0939C68.0458 25.0024 68.3986 25.8753 69.0298 26.5286C69.661 27.182 70.5213 27.5647 71.4292 27.596Z" fill="black"/>
<path class="logotype" d="M82.5576 17.1875L84.9951 26.3542L87.4326 19.0708L86.7659 17.1917H90.5159L93.7284 26.3583L96.1076 17.1917H99.9992L95.9034 30.975H91.9701L89.2284 23.4167L86.6659 30.9708H82.7076L78.6367 17.1875H82.5576Z" fill="black"/>
<path d="M20.8333 41.8334C32.3393 41.8334 41.6667 32.506 41.6667 21.0001C41.6667 9.49415 32.3393 0.166748 20.8333 0.166748C9.3274 0.166748 0 9.49415 0 21.0001C0 32.506 9.3274 41.8334 20.8333 41.8334Z" fill="#00EF8B"/>
<path d="M29.9732 17.7417H24.0898V23.625H29.9732V17.7417Z" fill="white"/>
<path d="M18.2138 25.8292C18.2138 26.266 18.0843 26.6929 17.8416 27.0561C17.599 27.4192 17.2541 27.7023 16.8506 27.8694C16.447 28.0366 16.003 28.0803 15.5746 27.9951C15.1463 27.9099 14.7528 27.6996 14.4439 27.3907C14.1351 27.0819 13.9248 26.6884 13.8396 26.26C13.7544 25.8316 13.7981 25.3876 13.9652 24.9841C14.1324 24.5806 14.4154 24.2357 14.7786 23.993C15.1417 23.7504 15.5687 23.6209 16.0055 23.6209H18.2138V17.7417H16.0055C14.4059 17.7417 12.8423 18.216 11.5123 19.1047C10.1823 19.9934 9.14572 21.2564 8.5336 22.7342C7.92147 24.212 7.76131 25.8382 8.07337 27.407C8.38543 28.9758 9.15569 30.4169 10.2867 31.5479C11.4178 32.679 12.8589 33.4492 14.4277 33.7613C15.9965 34.0733 17.6226 33.9132 19.1004 33.3011C20.5782 32.6889 21.8413 31.6523 22.73 30.3224C23.6186 28.9924 24.093 27.4287 24.093 25.8292V23.6209H18.2138V25.8292Z" fill="white"/>
<path d="M26.2984 14.8001H32.9151V8.91675H26.2984C24.1542 8.91895 22.0984 9.77174 20.5821 11.288C19.0659 12.8042 18.2131 14.86 18.2109 17.0042V17.7417H24.0901V17.0042C24.0912 16.4193 24.3244 15.8587 24.7384 15.4454C25.1524 15.0322 25.7135 14.8001 26.2984 14.8001V14.8001Z" fill="white"/>
<path d="M18.2109 23.6209H24.0901V17.7417H18.2109V23.6209Z" fill="#00EF8B"/>
</g>
<defs>
<clipPath id="clip0_106_24812">
<rect width="100" height="41.6666" fill="white" transform="translate(0 0.166748)"/>
</clipPath>
</defs>
</svg></div></a><nav role="navigation" class="new-navigation-menu w-nav-menu"><div data-hover="false" data-delay="0" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">Solutions</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list w-dropdown-list"><a href="../hybrid-custody.html" class="navigation-dropdown-link w-dropdown-link">Walletless Onboarding +Hybrid Custody</a><a href="http://developers.flow.com/hybrid-custody/guides/account-abstraction" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Account Abstraction</a><a href="https://developers.flow.com/cadence" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Cadence</a></nav></div><div data-hover="false" data-delay="0" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">Developers</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list w-dropdown-list"><a href="https://developers.flow.com/" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Developer portal</a><a href="https://github.com/onflow" class="navigation-dropdown-link w-dropdown-link">GitHub</a></nav></div><div data-hover="false" data-delay="0" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">Ecosystem</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list ecosystem w-dropdown-list"><a href="https://www.flowverse.co/" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Flowverse</a></nav></div><div data-hover="false" data-delay="0" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">Community</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list community w-dropdown-list"><a href="../flow-ambassador-program.html" class="navigation-dropdown-link w-dropdown-link">Ambassador program</a><a href="../blog.html" class="navigation-dropdown-link w-dropdown-link">Blog</a><a href="https://forum.onflow.org/" target="_blank" class="navigation-dropdown-link icon w-dropdown-link">Forum</a><a href="https://discord.com/invite/J6fFnh2xx6" target="_blank" class="navigation-dropdown-link discord w-dropdown-link">Discord</a><a href="https://twitter.com/flow_blockchain" class="navigation-dropdown-link twitter w-dropdown-link">Twitter</a></nav></div><div data-hover="false" data-delay="100" class="w-dropdown"><div class="new-nav-link w-dropdown-toggle"><div class="nav-link-text">About</div><div class="nav-link-dropdown-icon w-icon-dropdown-toggle"></div></div><nav class="navigation-dropdown-list ecosystem w-dropdown-list"><a href="../primer.html" class="navigation-dropdown-link w-dropdown-link">Primer</a><a href="../priorities.html" class="navigation-dropdown-link w-dropdown-link">Priorities</a><a href="../use-cases.html" class="navigation-dropdown-link w-dropdown-link">Use Cases</a><a href="../flow-token-economics.html" class="navigation-dropdown-link w-dropdown-link">Token economics</a><a href="../technical-paper.html" class="navigation-dropdown-link w-dropdown-link">Technical papers</a><a href="../sustainability.html" class="navigation-dropdown-link w-dropdown-link">Sustainability</a></nav></div></nav><div class="new-menu-button w-nav-button"><div class="w-icon-nav-menu"></div></div></div></div><div><div class="post-with-image-layout"><div class="blog-post-hero-2 wf-section"><div class="post-container w-container"><div><div class="blog-post-meta-data in-post"><div class="w-dyn-list"><div role="list" class="eng-blog-category-list w-dyn-items"><div role="listitem" class="w-dyn-item"><a href="../engineering-categories/blockchain.html" class="radius-text w-inline-block"><div class="eco-text-2">Blockchain</div></a></div></div></div><div class="small-dot-sep inpost left"></div><div class="blog-post-meta-text-data">April 14, 2023</div></div><div class="main-blog-post-title">Jolteon: Advancing Flow’s consensus algorithm</div><div class="blog-post-meta-data post"><a href="../authors/jordan-schalm.html" class="blog-post-meta-text-data dark">Jordan Schalm</a><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">Senior Software Engineer</div></div></div></div></div><div class="blog-post-section wf-section"><div class="container-25 _1280 w-container"><div class="post-info-parent"><div class="post-share-sidebar"><div class="social-share-btn-2 tw"></div><div class="social-share-btn-2 email"></div><div class="share-text">Share</div></div><div class="post-main-info-div eng"><img loading="lazy" src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/64397a4888791d71996cf86c_Blog%20Image%20-%20Jolteon_%20Advancing%20Flow%e2%80%99s%20Consensus%20Algorithm.png" alt="Jolteon: Advancing Flow’s consensus algorithm" sizes="(max-width: 479px) 83vw, (max-width: 767px) 92vw, (max-width: 991px) 81vw, 750px" srcset="https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/64397a4888791d71996cf86c_Blog%20Image%20-%20Jolteon_%20Advancing%20Flow%E2%80%99s%20Consensus%20Algorithm-p-500.png 500w, https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/64397a4888791d71996cf86c_Blog%20Image%20-%20Jolteon_%20Advancing%20Flow%E2%80%99s%20Consensus%20Algorithm-p-800.png 800w, https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/64397a4888791d71996cf86c_Blog%20Image%20-%20Jolteon_%20Advancing%20Flow%E2%80%99s%20Consensus%20Algorithm-p-1080.png 1080w, https://assets-global.website-files.com/618c953e65cc2ba3f44d1a02/64397a4888791d71996cf86c_Blog%20Image%20-%20Jolteon_%20Advancing%20Flow%E2%80%99s%20Consensus%20Algorithm.png 1600w" class="blog-post-main-image"/><div class="blog-post-rich-text-block w-richtext"><p>The consensus algorithm is the heart of any blockchain. It provides the fundamental guarantees of safety, liveness, and decentralization which enable the applications built on top. In January 2023, Flow upgraded to the Jolteon consensus algorithm. This upgrade results in about 33 percent faster block and transaction finalization times, as well as faster network upgrades. This translates into user interactions being confirmed more quickly and higher overall system stability and availability.</p><h2><strong>Background</strong></h2><p>Since Flow&#x27;s launch in 2020, it has used a consensus algorithm from the HotStuff family of Byzantine-fault-tolerant (BFT) algorithms[1]. HotStuff provides many useful properties in addition to the core requirements of a consensus algorithm:</p><ul role="list"><li>Deterministic Finality - Blocks which are marked as finalized by the algorithm are guaranteed to never change.</li><li>Optimistic Responsiveness - In the happy path, the algorithm will operate as quickly as the network allows, as opposed to needing to wait a fixed period of time for each block.</li><li>Pipelined Block Production - Each new proposal simultaneously extends the chain and help to finalize a previous block.</li></ul><p>The HotStuff protocol proceeds in a series of rounds (often called views) in which one node is the leader and may propose a new block by extending a previously proposed block. A new leader is selected for each subsequent round. (In the following diagrams, nodes other than the leader are referred to as replicas.) In the happy-path, a supermajority[2] of the committee will accept the block by voting for it. We refer to this as a successful round.</p><figure class="w-richtext-figure-type-image w-richtext-align-center" class="w-richtext-align-center w-richtext-figure-type-image"><div><img src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/64397810c49b0134034fd6de_rB52o0UzT86-cZm1axXMlLH2XkV4ZD4xtGRwJ5gxdBuwuWnUAhRTV7iZUHjSq5VLu9evyl1W1Gu56qlGAGokxCtz-bmV3XjX4D2ZMR8S0A4ACpjX8sdbjLEvSjj3b2YoKONcPdBgW-2rpw3Lz" alt=""/></div></figure><p>If no block is proposed, or not enough votes are gathered to reach a supermajority, then we consider the round to have failed. The protocol will try again with a new proposal in the next round.</p><figure class="w-richtext-figure-type-image w-richtext-align-center" class="w-richtext-align-center w-richtext-figure-type-image"><div><img src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/643978117215316838105d3f_ZPc2lVQkwJ52d55uKfIcHYzmJzKxCbscCN7ckjQ35Yw0Anun-E6ObiJQ4lkFUlRLujsC5w58CAtw_5z9NasPrPWdg9WKeFRq9WktjvFKuLste9ZSCGf_azbEQLMuywYdfd012GaxVCqmz0fL2" alt=""/></div></figure><p>Of particular interest to the latest upgrade is a component in HotStuff called the Pacemaker. Each node maintains a local current_view variable which is incremented when observing successful proposals for their current (or greater) view, or when indicated by the Pacemaker. The Pacemaker is responsible for ensuring individual nodes agree on the current view, so they can make progress together.</p><p>This is particularly important in the unhappy path of the protocol, to recover from an offline leader or transient networking failures. If there was a successful proposal in every round, the Pacemaker would never be called upon. The Pacemaker&#x27;s job is to determine when to proceed to the next round, in the absence of a successful proposal for the current round.</p><figure class="w-richtext-figure-type-image w-richtext-align-center" class="w-richtext-align-center w-richtext-figure-type-image"><div><img src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/643978100c6795514d02d5b4_TZelnRU0CfVnGgGvoxTh5QSHjBc6epskV0_yhlRvOp2bXh_7gSiMXp7g4Kgdp-bil5Cy1PokKp_4YCUyBCr3I9WEsQ33rrWymuYId2K3ZhgB2YkWXF-upKUKGPtdu_tWErpYxOvhXZaY1qjEO" alt=""/></div></figure><h2><strong>Challenges</strong></h2><p>Until now, Flow has used a Passive Pacemaker, which operates without exchanging any messages with other nodes. It decides whether to skip the current view based on knowledge of whether previous views succeeded and an exponential-increase timeout function. This makes it relatively simple to implement, but also limits its effectiveness, especially in edge cases. As we&#x27;ll see later, it also has indirect consequences to performance which are not immediately obvious.</p><p>To illustrate the limitations of the Passive Pacemaker, suppose a group of friends is organizing dinner. Alice, Bob, Charlie and Eve go to dinner every Friday. They take turns and each week one of them decides on a restaurant. This Friday, it is Eve’s turn, but Bob hasn’t heard anything from her. He isn’t sure whether he was the only one to miss Eve’s call. It could also be that Eve is camping and has no reception, in which case no one would have heard from Eve.</p><p>In this case, their usual process is that the next person in line (Alice) would pick a restaurant. Intuitively, Bob would call Alice and Charlie, confirm they also haven’t heard from Eve, then agree to skip Eve’s turn and let Alice pick a restaurant. However, in the more restrictive communication scheme of the Passive Pacemaker, this fallback call wouldn’t be allowed. All Bob can do is wait long enough until he is quite sure that Eve won’t call.</p><figure class="w-richtext-figure-type-image w-richtext-align-center" class="w-richtext-align-center w-richtext-figure-type-image"><div><img src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/64397811721531df0a105d40_Se84XZleky26PvHrwJVcU9Wavmn7RPg8B3-btA4n8-sm-RN96dEwwxZH809MJLl4y9mxYkLx_LO6KADY_hEjziMrk8NxHkAyUkgbPi1EF8mEB02y1bUft5W2CDIxW9Uw_U1lwEeId8p2LgEyQ" alt=""/></div></figure><p>Before discussing the actual upgrade, let&#x27;s consider what an optimal Pacemaker would look like. In order to make progress, a supermajority of nodes must be in the same view when a proposal for that view is produced, so an optimal Pacemaker would ensure that all nodes maintain a consistent view. When a view can&#x27;t proceed because of a leader failure, an optimal Pacemaker should skip that view as quickly as possible to avoid waiting for a proposal which will never arrive.</p><p>Because of the impracticality of coordinating clocks in a decentralized system, let alone one with Byzantine nodes, the Passive Pacemaker can&#x27;t keep all nodes on the same view. When timeouts are low and most views result in a successful proposal, the Passive Pacemaker performs quite well. However, when several views fail and more time passes without a successful proposal, the finalization rate can be severely impacted because each consecutive failed round exponentially increases the timeout for the next round.</p><p>At the limit, these challenging network conditions amount to a system outage.[3] Fortunately such failure scenarios are rare. However, over longer periods unplanned outages are inevitable and must be planned for. Similar conditions can also occur during planned network upgrades (called “sporks” for Flow[4]) as different node operators bring their nodes online at different times.</p><p>When these conditions occur, the network is split into groups, each with less than a supermajority of nodes, where different groups have different view and timeout values. Since we require a supermajority of nodes to be in the same view, no progress can be made until enough of these groups converge on the same view. Convergence is made much more time-consuming by the lack of active communication. The Passive Pacemaker is tuned so that nodes in higher views will timeout more slowly, so convergence will happen eventually, but &quot;eventually&quot; can be a long time. When groups differ by as little as 10 views (one group has current_view=n and a different group has current_view=n+10), the time to recovery can grow to minutes or even hours.</p><figure class="w-richtext-figure-type-image w-richtext-align-center" class="w-richtext-align-center w-richtext-figure-type-image"><div><img src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/6439781037417e140c23f4ab_3CHNh1LzFKirTJ3SIMGbZZ5RF6uGwXkBH8JOUtJOu62h0dllbF44nk6CFDm9deuf_4UT_fi8wFa5u4lI83jS0ICIY5VdSwzUfHLtwMOaQ6VolvcGAw70RIHyLg74NLKzjluIQFRFJ2xjmyzVD" alt=""/></div></figure><p>When view divergence occurs, the recovery time can be lowered by adjusting views and timeout values on different cohorts of nodes to manually increase the rate of convergence. This strategy can work, but it is a sensitive process to get right. It requires coordination between different node operators and an understanding of the Passive Pacemaker&#x27;s mechanics. The wrong adjustments can just as easily make the problem worse and lengthen the outage (which we have experienced first hand!). Although this mitigation can help, system recovery is generally too unreliable and impractically long.</p><p>To minimize the risk of view divergence during sporks, operators agree in advance on a startup time and configure their nodes for a coordinated startup at this time. This has worked well, but introduces additional downtime to the spork process. The startup time needs to accommodate the worst-case timing to ensure all operators are ready prior to startup. If the startup time needs to be pushed back for any reason, this requires a round of manual coordination and to accommodate worst-case timing again.</p><figure class="w-richtext-figure-type-image w-richtext-align-center" class="w-richtext-align-center w-richtext-figure-type-image"><div><img src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/64397810a5f13f351cfb0154_jraJpTMfsV7Hwe9SuOKHKKb7AyR-IRJxSkfQeXpD7zR_yjqZU0lQRSFegOydckWC6tZgL270ketZbJxXj-66qGRzoqkZ-KL5G8fp7rnoKKmsgx-X_ynKf6UI89h1igbLvIEOFgMdrq7-8N6Fp" alt=""/></div></figure><h1><strong>The Jolteon Consensus Protocol</strong></h1><p>Jolteon was originally<a href="https://arxiv.org/abs/2106.10362"> published</a> June 2021 by Meta’s blockchain research team, Novi, and academic collaborators. Meta’s team (now called Diem)<a href="https://github.com/diem/diem/blob/latest/consensus/README.md"> implemented</a> Jolteon and named it<a href="https://developers.diem.com/papers/diem-consensus-state-machine-replication-in-the-diem-blockchain/2021-08-17.pdf"> DiemBFT v4</a>, which was subsequently rebranded as<a href="https://github.com/aptos-labs/aptos-core/tree/main/developer-docs-site/static/papers/aptos-consensus-state-machine-replication-in-the-aptos-blockchain"> AptosBFT</a> without further modifications. Conceptually, Jolteon (DiemBFT, AptosBFT) belongs to the family of HotStuff consensus protocols. Jolteon follows the HotStuff framework of pipelined block finalization, but adds two significant improvements.</p><h2><strong>Active Pacemaker</strong></h2><p>The Jolteon algorithm&#x27;s first upgrade is the introduction of an Active Pacemaker. The Active Pacemaker extends the protocol to introduce an active recovery mechanism for views without a successful proposal. When a node times out, rather than immediately transitioning to the next view, they will first broadcast a timeout message including information about their current view and last observed successful proposal. Individual nodes will not leave a failed view until they observe timeout messages from a supermajority of nodes.</p><p>This explicit timeout step ensures that individual nodes only skip failed views based on evidence of a collective agreement to skip the view rather than isolated local timeouts. The result is that a supermajority of nodes must be within one view of each other at all times[5]. This effectively eliminates the possibility of view divergence and its related negative impacts.</p><p>Returning to the example of friends organizing dinner, this is analogous to Bob being able to fallback to direct communication with Alice and Charlie when he does not see Eve’s message. They can quickly determine whether Eve has gone camping or whether Bob just missed her call, and decide how to proceed.</p><p>During sporks, nodes may start up as soon as they are able. At first, when a supermajority is not online yet, these nodes will not skip any views. As soon as a supermajority of nodes come online, the network will begin finalizing blocks without manual coordination or waiting for view convergence. Similarly, for the duration of any outage that may occur, all honest nodes will remain in the same view, even if they cannot finalize any blocks. As soon as the root cause is resolved, finalization can immediately resume. This translates to shorter sporks, less operational overhead, and faster recovery from unexpected outages.</p><p>In addition, since failed views can be explicitly handled while maintaining view synchronization, we have more flexibility to adjust the timeout configuration. In any system, especially one which must account for the presence of Byzantine participants, failures are expected. Where each failed view with a Passive Pacemaker would cause a subsequent failed view to take twice as long to time out, the Active Pacemaker can allow a few consecutive failed views to pass without increasing the timeout, then only begin increasing the timeout when it appears that network conditions have durably degraded.</p><figure class="w-richtext-figure-type-image w-richtext-align-center" class="w-richtext-align-center w-richtext-figure-type-image"><div><img src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/643978128ae656dd919cd724_pP0U2kZ5FgcL2tgxvKI8Qfa_B-kAR_GRkMR5ohZIuWsD3KcnuZePnslFzQITVrY9MHidRahYgHQrKr2sT37GysL7qWht4K-tg_g8YOad0mJLj-dgHdqzm-q7GLzW6r6TlmTvpqmEed-EgnrGm" alt=""/></div></figure><h2><strong>Finalization Speed</strong></h2><p>Flow uses a flavour of the HotStuff consensus algorithm which provides deterministic finality for a block once enough confirmations of that block have been incorporated into the chain. When a block is finalized, it means that the transactions within have been irrevocably accepted by the network[6], so the time required to finalize a block is directly related to the user&#x27;s experience of how long their operations take to complete.</p><p>Since HotStuff is a pipelined algorithm, each confirmation of a previous block is simultaneously a newly proposed block containing new user transactions. This also means that each confirmation for a block takes as much time as proposing and voting for a new block. On Mainnet this is a little over one second.</p><p>Up to this point, Flow&#x27;s consensus has required 3 successful confirmations for a block to be finalized. With the Jolteon upgrade, finalization can be achieved after only two confirmations. This difference is achievable because of the introduction of the Active Pacemaker. The addition to the protocol of explicit communication about failed views changes the logic of safety to enable individual nodes to convince themselves of consensus on a block more quickly.</p><figure class="w-richtext-figure-type-image w-richtext-align-center" class="w-richtext-align-center w-richtext-figure-type-image"><div><img src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/64397811cdab2ea987d584b6_brzSFZsyGV4ZFAg3ovwcYRoa7HaR34whuJwOy7EeGrBqLIjMj0DfjqoNi3w053x3XpCDjerf5V5K0UM36jMXuW9DFV7CBMzmkvUwDFFgWuf4PfN-EtPMWL5f9TUAr7_g7Zl7Gi7hwJFop_wdE" alt=""/></div></figure><p>Let&#x27;s consider an example to illustrate how active communication in the recovery path enables faster finalization in the happy path. In the Asterix comics, the Roman armies are attempting to attack the Gaul village. The Romans believe that they will only succeed if they attack at the same time, so their armies must agree on when to attack. Each army is hidden away on separate sides of the village, so they must communicate using a carrier pigeon. Sometimes carrier pigeons get lost or delayed, despite their best efforts.</p><h3><strong>Caesar’s Proposal (0-Chain)</strong></h3><p>At sunrise, Caesar sends a proposal to attack at 8PM to all the armies. Our army sends a response saying that we are ready to attack at 8PM. At this point, we know only that our army and Caesar agree on the attack time. We aren&#x27;t sure whether the other armies received Caesar&#x27;s proposal, or even if Caesar received our response, so it isn&#x27;t safe for us to commit to an attack.</p><figure class="w-richtext-figure-type-image w-richtext-align-center" class="w-richtext-align-center w-richtext-figure-type-image"><div><img src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/643978110c679502e902d5fa_1Am6EREFZa9k4kRTOhZDU2tNYH7LwaLPxFYm9rf2k6NIa9ZzgtqNuprzcpgzjbRmoYJzGteoHYcPjWF8HD1v1F_3MkEqLDNj82M4ga1qNIKw5XraAPQCio-uTilCNnFbdpxsnDi2xC11dS0r2" alt=""/></div></figure><p>We refer to our local knowledge as a 0-chain because we have a proposal but no confirmations for it.</p><h3><strong>1st Confirmation (1-Chain)</strong></h3><p>At noon, we receive a second message from Caesar saying that all the armies have confirmed they could attack at 8PM. We send a response acknowledging this. At this point, we know that Caesar received a confirmation for 8PM from all the other armies. But what do the other armies know?</p><p>If Caesar&#x27;s second message failed to reach the other armies, then those armies would be in the same position we were in after receiving only the proposal, and would consider it unsafe to commit to an attack. At this point, we know that all armies have relayed they could be ready to attack at 8PM. However, we aren&#x27;t sure whether the <em>other</em> armies know this. So it is still not safe for us to commit to an attack.</p><figure class="w-richtext-figure-type-image w-richtext-align-center" class="w-richtext-align-center w-richtext-figure-type-image"><div><img src="../../assets-global.website-files.com/618c953e65cc2ba3f44d1a02/643978110c6795cac802d71d_WSVBpS5jec4saAyz0OeDQArKOPASApTb4WkUiE85aUwZXYqlZuD8dNcJRiis9oG0WDqJUZTepU7RYh0Xe21k-8Zo-nl-xo_YXh_q7AhyJhJ2Bknz59MtMqM0u534ZW6qjGUMtQDG_jlr7RR3E" alt=""/></div></figure><p>We now refer to our local knowledge as a 1-chain, because we have a proposal and one round of confirmations for the proposal.</p><h3><strong>2nd Confirmation (2-Chain)</strong></h3><p>Finally, as twilight falls and our soldiers grow anxious, we receive a third message from Caesar saying that all armies have acknowledged his second message. At this point we know that all other armies are aware of Roman commitment on 8PM. This third message is evidence of Roman commitment to attack.</p><p>It seems like we should be able to attack now, but what if another army didn&#x27;t receive Caesar&#x27;s third message? Then they would have the same knowledge we had at noon, after receiving the second message. In fact, after each message we receive, we can only know that all armies received the <em>previous</em> messages. In the worst case, the most recent message may only have reached us.</p><p>If all armies had received the third message, then all armies would have the information they need to commit to the attack. In other words, the <em>evidence to convince all armies to commit exists</em>. The problem is making sure that all armies see the evidence.</p><p>So, what do we do? One option is for Caesar to send yet another message, once he has received another round of confirmations from all armies. This message will inform us that all armies have seen the evidence of Roman consensus they need to commit to the attack. This would create a 3-chain (3 consecutive confirmations for the proposal), which is sufficient to finalize the proposal without active fallback communication.</p><p>But what if the armies had the ability to communicate amongst themselves, only if they failed to receive timely communication from Caesar? Video-conferencing is a new and very expensive technology in the Roman Empire, so the Treasury will only approve its use in the most dire of circumstances. They strongly prefer pigeons.</p><p>With this ability to fallback to group communication at our disposal, all our army needs to commit to the attack is to know that the <em>agreement evidence exists</em> (2-chain). Hopefully Caesar&#x27;s final message, containing this evidence, will reach all armies. Failing this, we will be able to communicate our copy of the evidence to the other armies with a quick video-conference.</p><h2><strong>Conclusion</strong></h2><p>This upgrade represents a significant step forward in Flow’s evolution, bringing the latest advancements in consensus research to a production environment. The Active Pacemaker improves reliability by facilitating faster recovery from network upgrades and reducing the likelihood and impact of unplanned outages. This in turn enables a 2-chain block finalization rule which results in approximately a 33 percent faster transaction finalization. Both improvements ultimately provide a more robust platform for users and application developers.</p><p><em>Thank you to Alex Hentschel, Jerome Pimmel, Misha Rybalov, Tarak Ben Youssef, and Yurii Oleksyshyn for contributing to this content.</em></p><h2><strong>Notes</strong></h2><p>[1] A Byzantine node may fail to receive or send messages (like a node affected by benign networking failure), but may also break protocol rules, such as sending different proposals to different nodes, voting for multiple conflicting proposals, or attempting to impersonate a different node.</p><p>[2] A supermajority is formed by strictly greater than 2/3s of the committee. In particular, with a chosen “Byzantine threshold” f, a committee must have at least 3f+1 nodes and a supermajority is formed by 2f+1 nodes. For example, a committee with 4 nodes can tolerate at most 1 Byzantine node; a committee with 100 nodes can tolerate at most 33 Byzantine nodes.</p><p>[3] For example, suppose we start with a timeout value of 2 second and are facing a series of 11 consecutive offline leaders. After the 10th failed view, a consensus’ node timeout will increase 2s * 2^10 = 2048s. Hence, the node will wait 34mins in view 11 alone, before giving up and transitioning to view 12.</p><p>[4] A fork occurs when a breaking change is introduced to a blockchain — if some nodes have not upgraded, then they may disagree about what is a valid extension to the chain and build a conflicting version of history after the upgrade. A spoon occurs when the application state of a blockchain is used to initialize a new blockchain, rather than initializing from an empty state. We use the term “spork” because network upgrades in Flow combine both these properties, enabling speedy upgrades to both the protocol (how nodes communicate with one another) and execution environment (how transactions are executed and application data is stored).</p><p>[5] This supermajority is the set of nodes which contributed either a vote or a timeout used to end the previous round. Its members may change from round to round. This has an impact on security of different Byzantine threshold assumptions. The highest possible Byzantine threshold is f Byzantine nodes with at least 2f+1 honest nodes, but a given system may or may not allow for these f nodes to change from time to time.</p><p>[6] Technically it means that a final order for the transactions has been determined, so the transactions’ results are fixed and knowable, but not yet available to clients. To be completed they must be executed and sealed as well, but finalization is a critical step in the transaction processing path.</p><p>‍</p></div><div class="tags-post-div"><div class="tags-title-14">Tags:</div><div class="w-dyn-list"><div class="w-dyn-empty"><div>No items found.</div></div></div></div></div></div></div></div></div><div class="post-with-text-layout hide"><div class="blog-post-hero-2 no-image wf-section"><div class="post-container w-container"><div><div class="blog-post-meta-data in-post"><div class="blog-post-category">Studio</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">03/30/2021</div></div><div class="main-blog-post-title">Welcoming Animoca, MotoGP, and StarGirl to Flow</div><div class="blog-post-meta-data post"><div class="blog-post-meta-text-data dark">Mik Naayem</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">CBO and Cofounder at Dapper Labs</div></div></div></div></div><div class="blog-post-section wf-section"><div class="container-25 _1280 w-container"><div class="post-info-parent no-img"><div class="post-share-sidebar"><div class="social-share-btn-2 tw"></div><div class="social-share-btn-2 email"></div><div class="share-text">Share</div></div><div class="post-main-info-div"><div class="blog-post-rich-text w-richtext"><p>The rich text element allows you to create and format headings, paragraphs, blockquotes, images, and video all in one place instead of having to add and format them individually. Just double-click and easily create content.</p><ul role="list"><li>Decentralized because you can set up a blockchain system so that every entity can only make changes within its predefined purview. Companies can also use permissionless, permissioned, or hybrid-approach blockchains, allowing for useful trade-offs between network security and system privacy.</li><li>Decentralized because you can set up a blockchain system so that every entity can only make changes within its predefined purview. Companies can also use permissionless, permissioned, or hybrid-approach blockchains, allowing for useful trade-offs between network security and system privacy.</li><li>scscsssc</li></ul><h4>Static and dynamic content editing</h4><blockquote>A rich text element can be used with static or dynamic content. For static content, just drop it into any page and begin editing. For dynamic content, add a<a href="http://www.google.com/"> rich text field to any collection</a> and then connect a rich text element to that field in the settings panel. Voila!</blockquote><h4>How to customize formatting for each rich text</h4><p>Headings, paragraphs, blockquotes, figures, images, and figure captions can all be styled after a class is added to the rich text element using the &quot;When inside of&quot; nested selector system.</p></div></div></div></div></div></div><div class="section-32 wf-section"><div class="container-25 _1280 w-container"><div class="title-div-3"><div>Related Content</div></div><div class="w-dyn-list"><div role="list" class="w-dyn-items"><div role="listitem" class="w-dyn-item"><div class="blog-post-parant-div first"><div class="blog-post-info-div"><a href="upgrading-flows-consensus-follower-to-boost-attack-resilience-and-processing-speed.html" class="blog-post-title">Upgrading Flow&#x27;s Consensus Follower to boost attack resilience and processing speed</a><div class="blog-post-meta-data"><div class="blog-post-meta-text-data">May 30, 2023</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">Jordan Schalm</div></div></div></div></div><div role="listitem" class="w-dyn-item"><div class="blog-post-parant-div first"><div class="blog-post-info-div"><a href="golang-services-improving-observability.html" class="blog-post-title">Improving Observability of GoLang Services</a><div class="blog-post-meta-data"><div class="blog-post-meta-text-data">Jan 31, 2023</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">Alexey Ivanov</div></div></div></div></div><div role="listitem" class="w-dyn-item"><div class="blog-post-parant-div first"><div class="blog-post-info-div"><a href="flow-blockchain-programming-language-smart-contract-cadence-solidity-comparison-ethereum.html" class="blog-post-title">Cadence or Solidity: On-Chain Token Transfer Deep Dive</a><div class="blog-post-meta-data"><div class="blog-post-meta-text-data">Jan 24, 2023</div><div class="small-dot-sep"></div><div class="blog-post-meta-text-data">Jerome Pimmel</div></div></div></div></div></div></div></div></div></div><div class="section footer wf-section"><div class="footer-div"><div class="join-text-2 no-hover">Join Flow on</div><a href="https://twitter.com/flow_blockchain" target="_blank" class="join-text-2">Twitter</a><a href="https://discord.com/invite/J6fFnh2xx6" target="_blank" class="join-text-2">Discord</a><a href="../index.html" target="_blank" class="join-text-2">flow.com</a></div></div><div class="new-footer wf-section"><div class="container w-container"><div class="w-layout-grid _3-footer-grid"><div><a id="w-node-ec243fb8-8059-5bdb-528d-ce0b082ca18b-082ca187" href="../index.html" class="footer-logo-link w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63ce603ae36f46f6bb67e51e_flow-logo.svg" loading="lazy" alt="flow logo" class="footer-logo-img"/></a><div class="footer-social-icons"><a href="https://twitter.com/flow_blockchain" target="_blank" class="footer-social-icon w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63cec770abbeba426e358f76_Twitter - Negative.svg" loading="lazy" alt="social icon"/></a><a href="https://www.instagram.com/flowblockchain" target="_blank" class="footer-social-icon w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63cec770799e2958d15306a0_Instagram - Negative.svg" loading="lazy" alt="social icon"/></a><a href="https://www.youtube.com/@FlowBlockchain" target="_blank" class="footer-social-icon w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63cec77005a49eaba248e147_YouTube - Negative.svg" loading="lazy" alt="social icon"/></a><a href="https://t.me/flow_blockchain" target="_blank" class="footer-social-icon w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63cec770b75d5482a08014db_Telegram - Negative.svg" loading="lazy" alt="social icon"/></a><a href="https://discord.com/invite/J6fFnh2xx6" target="_blank" class="footer-social-icon last w-inline-block"><img src="https://assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/63d0398494fe5d96e72f4cc0_Social Icon.svg" loading="lazy" alt="social icon"/></a></div></div><div id="w-node-_843ebe60-d3a2-032c-780e-737a5989cba0-082ca187"><div class="footer-column-header">Start Building</div><a href="https://developers.flow.com/" target="_blank" class="new-footer-link">Developer portal</a><a href="https://github.com/onflow" target="_blank" class="new-footer-link">GitHub</a></div><div id="w-node-ec243fb8-8059-5bdb-528d-ce0b082ca19f-082ca187"><div class="footer-column-header">Flow</div><a href="https://docs.google.com/forms/d/e/1FAIpQLSer5ZX0pRWsXF0U0bsgW4Zo8Pmlw0V927ZydDq_ej-qyIJ9_A/viewform" target="_blank" class="new-footer-link">Business Development</a><a href="../node-operation.html" target="_blank" class="new-footer-link">Node Operation</a><a href="../token-distribution.html" class="new-footer-link">Token Distribution</a><a href="../mediakit.html" class="new-footer-link">Media Kit</a><a href="../careers.html" class="new-footer-link">Careers</a><a href="../faq.html" class="new-footer-link">FAQ</a></div><div id="w-node-ec243fb8-8059-5bdb-528d-ce0b082ca198-082ca187"><div class="footer-column-header">Get Connected</div><a href="https://port.onflow.org/" target="_blank" class="new-footer-link">Flow Port</a><a href="https://www.flowverse.co/" target="_blank" class="new-footer-link">Flowverse</a></div></div><div class="div-block-129"><div class="footer-copyright">© 2023 All Rights Reserved</div></div></div></div><script src="../../d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c89892.js?site=5f734f4dbd95382f4fdfa0ea" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script><script src="../../assets-global.website-files.com/5f734f4dbd95382f4fdfa0ea/js/webflow.2724f1538.js" type="text/javascript"></script><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NHJB3BPPXG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NHJB3BPPXG');
</script>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PWSGFLB"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --><script src="../../cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="../../cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/unescaped-markup/prism-unescaped-markup.min.js"></script></body>
<!-- Mirrored from flow.com/engineering-blogs/jolteon-advancing-flows-consensus-algorithm by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 22 Jul 2023 16:22:20 GMT -->
</html>